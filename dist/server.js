/*! For license information please see server.js.LICENSE.txt */
(()=>{var e={62:e=>{function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],l=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function a(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var l=function(){return a((function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i(this,e),this.tileX=t,this.tileY=r,this.code=n,this.mapId=o}),[{key:"getPositionKey",value:function(){return"".concat(this.tileX,"_").concat(this.tileY)}},{key:"serialize",value:function(){return{tileX:this.tileX,tileY:this.tileY,code:this.code,mapId:this.mapId}}}])}(),c=function(){return a((function e(){i(this,e),this.teleportersByPosition=new Map,this.teleportersByCode=new Map,this.teleporterLinks=[]}),[{key:"addTeleporter",value:function(e){var t=e.getPositionKey();this.teleportersByPosition.set(t,e),e.code?(this.teleportersByCode.set(e.code,e),console.log("Added teleporter with code ".concat(e.code," at position ").concat(t))):console.log("Added teleporter at position ".concat(t," (no code yet)"))}},{key:"getTeleporterByPosition",value:function(e,t){var r="".concat(e,"_").concat(t);return this.teleportersByPosition.get(r)||null}},{key:"getTeleporterByCode",value:function(e){var t=this.teleportersByCode.get(e)||null;return console.log("Looking for teleporter with code ".concat(e,": ").concat(t?"FOUND":"NOT FOUND")),t}},{key:"getTeleporterByLink",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=null!==n?"".concat(n,",").concat(e,",").concat(r):"0,".concat(e,",").concat(r),o=this.teleporterLinks.find((function(e){return e.fromKey===i}));if(o){console.log("Found teleporter link from ".concat(i," to ").concat(o.toKey));var a=t(o.toKey.split(",").map(Number),3),s=a[0],c=a[1],u=a[2],h=new l(c,u);return h.targetMapIndex=s,{teleporter:h,mapIndex:s}}return null}},{key:"setTeleporterLinks",value:function(e){var r=this;e&&Array.isArray(e)?(this.teleporterLinks=e,console.log("Set ".concat(e.length," teleporter links")),e.forEach((function(e){var n=t(e.fromKey.split(",").map(Number),3),i=n[0],o=n[1],a=n[2],s=t(e.toKey.split(",").map(Number),3),c=s[0],u=(s[1],s[2],"".concat(o,"_").concat(a)),h="map".concat(i,"_to_map").concat(c),f=r.teleportersByPosition.get(u);f?f.code||(f.code=h,f.mapId="map".concat(c),r.teleportersByCode.set(h,f)):(f=new l(o,a,h,"map".concat(c)),r.addTeleporter(f))}))):console.log("No teleporter links to set or invalid format")}},{key:"associateTeleporterCodes",value:function(e){if(e&&0!==e.length){console.log("Associating ".concat(e.length," teleporter codes"));for(var t=Array.from(this.teleportersByPosition.keys()),r=0;r<e.length;r++){var n=e[r];if(r<t.length){var i=t[r],o=this.teleportersByPosition.get(i);o.code=n.code,o.mapId=n.mapId,this.teleportersByCode.set(n.code,o),console.log("Associated teleporter at ".concat(i," with code ").concat(n.code," -> ").concat(n.mapId))}else console.warn("Not enough teleporter positions for code ".concat(n.code))}}else console.warn("No teleporter codes available for map")}}])}();e.exports={Teleporter:l,TeleporterManager:c}},74:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return(t=c(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function c(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}function h(e,t,r,n){var i=f(p(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof i?function(e){return i.apply(r,e)}:i}function f(){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},f.apply(null,arguments)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}var d=r(110).Enemy,v=r(833).Bullet,m=function(e){function t(e,r,i,o){var a,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:500,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:400,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:100,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:5;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=function(e,t,r){return t=p(t),function(e,t){if(t&&("object"==n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,u()?Reflect.construct(t,r||[],p(e).constructor):t.apply(e,r))}(this,t,[e,r,i,o,2])).detectionRangeSq=s*s,a.shootingRangeSq=l*l,a.shootCooldown=0,a.maxShootCooldown=c,a.bulletRadius=h,a.bulletSpeed=f,a.lastTargetX=null,a.lastTargetY=null,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}(t,e),r=t,(i=[{key:"update",value:function(e,r,n){if(h(t,"update",this,3)([e,r]),this.shootCooldown>0&&this.shootCooldown--,n&&0===this.shootCooldown){var i,o=n.players,a=null,l=this.detectionRangeSq,c=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw o}}}}(o.values());try{for(c.s();!(i=c.n()).done;){var u=i.value;if(!u.isDead&&u.currentMapId===n.currentMapId&&!this.isPlayerInProtectedTile(u,n,e)){var f=u.x-this.x,p=u.y-this.y,y=f*f+p*p;y<l&&(l=y,a=u)}}}catch(e){c.e(e)}finally{c.f()}if(a&&l<=this.shootingRangeSq){this.lastTargetX=a.x,this.lastTargetY=a.y;var d=new v(this.x,this.y,this.lastTargetX,this.lastTargetY,this.bulletRadius,this.bulletSpeed);if(n.mapBullets&&n.currentMapId){var m=n.mapBullets.get(n.currentMapId)||new Map;m.set(d.id,d),n.mapBullets.set(n.currentMapId,m),d.addToGrid(r)}this.shootCooldown=this.maxShootCooldown}else this.lastTargetX=null,this.lastTargetY=null}}},{key:"isPlayerInProtectedTile",value:function(e,t,r){if(!e||!t)return!0;var n=r||t.mapManager.getMapById(e.currentMapId);if(!n)return!0;var i=Math.floor(e.x/n.tileSize),o=Math.floor(e.y/n.tileSize),a=n.getTileType(i,o);return 2===a||3===a||4===a}},{key:"serialize",value:function(){return o(o({},h(t,"serialize",this,3)([])),{},{detectionRange:Math.sqrt(this.detectionRangeSq),shootingRange:Math.sqrt(this.shootingRangeSq)})}}])&&l(r.prototype,i),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i}(d);e.exports={Sniper:m}},86:e=>{"use strict";e.exports=require("ws")},106:e=>{"use strict";e.exports=require("zlib")},110:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}function a(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}r(903).v4;var s,l,c=1e3/60,u=function(){return e=function e(t,r,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="".concat(o,"_").concat(e.counter++),this.type=o,this.x=t,this.y=r,this.prevX=t,this.prevY=r,this.radius=n;var a={1:{name:"Basic",color:"#808080",outlineColor:"#000000"},2:{name:"Sniper",color:"#8B0000",outlineColor:"#000000"},3:{name:"Dasher",color:"#003c66",outlineColor:"#001830"},4:{name:"Homing",color:"#7F00FF",outlineColor:"#5c4200"},5:{name:"VoidCrawler",color:"#1c0a2d",outlineColor:"#0d0517"},6:{name:"Wall",color:"#222222",outlineColor:"#111111"}},s=a[o]||a[1];this.color=s.color,this.outlineColor=s.outlineColor;var l=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1},{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:-1}],c=l[Math.floor(Math.random()*l.length)],u=.4*Math.random()-.2,h=.4*Math.random()-.2,f=c.x+u,p=c.y+h,y=f*f+p*p;if(y>0){var d=Math.sqrt(y);this.vx=f/d*i,this.vy=p/d*i}else this.vx=i,this.vy=0;this.speed=i,this.lastUpdateTime=Date.now(),this._collisionShape={id:this.id,x:0,y:0,radius:this.radius}},(t=[{key:"_normalizeVelocity",value:function(){var e=this.vx*this.vx+this.vy*this.vy;if(e>0){var t=Math.sqrt(e);t!==this.speed&&(this.vx=this.vx/t*this.speed,this.vy=this.vy/t*this.speed)}else if(this.speed>0){var r=Math.random()*Math.PI*2;this.vx=Math.cos(r)*this.speed,this.vy=Math.sin(r)*this.speed}}},{key:"update",value:function(e,t){var r=Date.now(),n=(r-this.lastUpdateTime)/c;this.lastUpdateTime=r,this.prevX=this.x,this.prevY=this.y;var i=!1,o=this.x+this.vx*n,a=this.y+this.vy*n;this._collisionShape.x=o,this._collisionShape.y=this.y,this._collisionShape.radius=this.radius,t.checkWallCollision(this._collisionShape)||t.checkSafeZoneCollision(this._collisionShape)||t.checkTeleporterCollision(this._collisionShape)?(this.vx=-this.vx,this.vx+=.2*(Math.random()-.5),this.vy+=.2*(Math.random()-.5),this._normalizeVelocity()):(this.x=o,i=!0),this._collisionShape.x=this.x,this._collisionShape.y=a,t.checkWallCollision(this._collisionShape)||t.checkSafeZoneCollision(this._collisionShape)||t.checkTeleporterCollision(this._collisionShape)?(this.vy=-this.vy,this.vx+=.2*(Math.random()-.5),this.vy+=.2*(Math.random()-.5),this._normalizeVelocity()):(this.y=a,i=!0),this._collisionShape.x=this.x,this._collisionShape.y=this.y,(t.checkWallCollision(this._collisionShape)||t.checkSafeZoneCollision(this._collisionShape)||t.checkTeleporterCollision(this._collisionShape)||this.x-this.radius<0||this.x+this.radius>e.width*e.tileSize||this.y-this.radius<0||this.y+this.radius>e.height*e.tileSize)&&(this.x=this.prevX,this.y=this.prevY,i=!1,this.vx=-this.vx,this.vy=-this.vy,this.vx+=.5*(Math.random()-.5),this.vy+=.5*(Math.random()-.5),this._normalizeVelocity()),i&&t.update(this)}},{key:"checkEnemyCollisions",value:function(e){var t,r=e.getNearbyEntities(this),n=[],o=this.radius,a=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw a}}}}(r);try{for(a.s();!(t=a.n()).done;){var s=t.value,l=e.entities.get(s);if(l&&l.entity){var c=l.entity;if(c!==this){var u=this.x-c.x,h=this.y-c.y,f=u*u+h*h,p=o+c.radius;f<p*p&&n.push(c)}}}}catch(e){a.e(e)}finally{a.f()}return n}},{key:"serialize",value:function(){return{id:this.id,type:this.type,x:this.x,y:this.y,prevX:this.prevX,prevY:this.prevY,radius:this.radius}}},{key:"addToGrid",value:function(e){e.insert(this)}},{key:"removeFromGrid",value:function(e){e.remove(this.id)}}])&&o(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();s=u,(l=a(l="counter"))in s?Object.defineProperty(s,l,{value:0,enumerable:!0,configurable:!0,writable:!0}):s[l]=0,e.exports={Enemy:u,MS_PER_GAME_TICK:c}},127:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(){"use strict";i=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",l=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r,n){return Object.defineProperty(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function h(t,r,n,i){var o=r&&r.prototype instanceof y?r:y,a=Object.create(o.prototype);return u(a,"_invoke",function(t,r,n){var i=1;return function(o,a){if(3===i)throw Error("Generator is already running");if(4===i){if("throw"===o)throw a;return{value:e,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var l=M(s,n);if(l){if(l===p)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===i)throw i=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=3;var c=f(t,r,n);if("normal"===c.type){if(i=n.done?4:2,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=4,n.method="throw",n.arg=c.arg)}}}(t,n,new O(i||[])),!0),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p={};function y(){}function d(){}function v(){}var m={};u(m,s,(function(){return this}));var g=Object.getPrototypeOf,b=g&&g(g(T([])));b&&b!==r&&o.call(b,s)&&(m=b);var w=v.prototype=y.prototype=Object.create(m);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(i,a,s,l){var c=f(e[i],e,a);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==n(h)&&o.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,s,l)}),(function(e){r("throw",e,s,l)})):t.resolve(h).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,l)}))}l(c.arg)}var i;u(this,"_invoke",(function(e,n){function o(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(o,o):o()}),!0)}function M(t,r){var n=r.method,i=t.i[n];if(i===e)return r.delegate=null,"throw"===n&&t.i.return&&(r.method="return",r.arg=e,M(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var o=f(i,t.i,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var a=o.arg;return a?a.done?(r[t.r]=a.value,r.next=t.n,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,p):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function _(e){this.tryEntries.push(e)}function k(t){var r=t[4]||{};r.type="normal",r.arg=e,t[4]=r}function O(e){this.tryEntries=[[-1]],e.forEach(_,this),this.reset(!0)}function T(t){if(null!=t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(o.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return d.prototype=v,u(w,"constructor",v),u(v,"constructor",d),d.displayName=u(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,c,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},S(x.prototype),u(x.prototype,l,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new x(h(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(w),u(w,c,"Generator"),u(w,s,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},t.values=T,O.prototype={constructor:O,reset:function(t){if(this.prev=this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e){a.type="throw",a.arg=t,r.next=e}for(var i=r.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o[4],s=this.prev,l=o[1],c=o[2];if(-1===o[0])return n("end"),!1;if(!l&&!c)throw Error("try statement without catch or finally");if(null!=o[0]&&o[0]<=s){if(s<l)return this.method="next",this.arg=e,n(l),!0;if(s<c)return n(c),!1}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var i=n;break}}i&&("break"===e||"continue"===e)&&i[0]<=t&&t<=i[2]&&(i=null);var o=i?i[4]:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i[2],p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[2]===e)return this.complete(r[4],r[3]),k(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[0]===e){var n=r[4];if("throw"===n.type){var i=n.arg;k(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={i:T(t),r,n},"next"===this.method&&(this.arg=e),p}},t}function o(e,t,r,n,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,i)}var a=r(252),s=r(611),l=r(86),c=r(106),u=r(928),h=r(654).Game,f=r(876).MapManager,p=r(149),y=r(417).handleNewConnection,d=a(),v=s.createServer(d),m=new l.Server({server:v});d.use(a.static(p.STATIC_PATH,{setHeaders:function(e,t){t.endsWith(".js")&&e.setHeader("Content-Type","application/javascript")}})),d.get("/mapeditor",(function(e,t){t.sendFile(u.join(p.STATIC_PATH,"mapeditor.html"))}));var g=new h(new f);function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=c.gzipSync(Buffer.from(e));m.clients.forEach((function(e){if(e.readyState===l.OPEN&&e!==t)try{e.send(r,{binary:!0})}catch(e){console.error("Failed to send message to client:",e)}}))}m.on("connection",function(){var e,t=(e=i().mark((function e(t,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(t,r,g,b);case 2:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){o(a,n,i,s,l,"next",e)}function l(e){o(a,n,i,s,l,"throw",e)}s(void 0)}))});return function(e,r){return t.apply(this,arguments)}}()),g.start(),v.listen(p.PORT,(function(){console.log("Server running on port ".concat(p.PORT)),console.log("Map editor available at http://localhost:".concat(p.PORT,"/mapeditor"))})),process.on("SIGINT",(function(){console.log("Shutting down server..."),v.close((function(){console.log("Server closed"),g.stop(),process.exit(0)}))})),e.exports={server:v,app:d,game:g}},149:(e,t,r)=>{var n=r(928),i={PORT:process.env.PORT||3e3,STATIC_PATH:n.resolve(__dirname,"..","dist","public"),DEFAULT_MAP_ID:"map1",BINARY_MESSAGE_MOUSE_MOVE:1,MAX_CHAT_MESSAGE_LENGTH:256};e.exports=i},165:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return(t=l(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,l(n.key),n)}}function l(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}function c(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(c=function(){return!!e})()}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},u.apply(null,arguments)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}var p=function(e){function t(e,r,i,o,a,s,l,u,f,p){var y,d=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,m=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(y=function(e,t,r){return t=h(t),function(e,t){if(t&&("object"==n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,c()?Reflect.construct(t,r||[],h(e).constructor):t.apply(e,r))}(this,t,[e,r,i,o,6])).speed=o,y.boundary={x:a,y:s,w:l,h:u},y.moveClockwise=!d,y.wallIndex=f,y.direction=v;var g,b=2*(y.boundary.w+y.boundary.h);return g=m?f*m:f*b/p,y.initialSide=v,y.positionAlong(g,i),y.applySpeed(),y}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(t,e),r=t,i=[{key:"top",value:function(){return this.boundary.y}},{key:"bottom",value:function(){return this.boundary.y+this.boundary.h}},{key:"right",value:function(){return this.boundary.x+this.boundary.w}},{key:"left",value:function(){return this.boundary.x}},{key:"rotate",value:function(e,t){switch(e){case 0:return t?3:1;case 2:return t?1:3;case 1:return t?0:2;case 3:return t?2:0}}},{key:"getVector",value:function(){switch(this.direction){case 0:this.vx=0,this.vy=-this.speed;break;case 2:this.vx=0,this.vy=this.speed;break;case 1:this.vx=this.speed,this.vy=0;break;case 3:this.vx=-this.speed,this.vy=0}}},{key:"applySpeed",value:function(){this.getVector()}},{key:"positionAlong",value:function(e,t){0===this.initialSide?(this.x=this.boundary.w/2+this.left(),this.y=this.top()+t):1===this.initialSide?(this.x=this.right()-t,this.y=this.boundary.h/2+this.top()):2===this.initialSide?(this.x=this.boundary.w/2+this.left(),this.y=this.bottom()-t):3===this.initialSide&&(this.x=this.left()+t,this.y=this.boundary.h/2+this.top()),this.direction=this.rotate(this.initialSide,this.moveClockwise);for(var r=0;e>0;){if(r>1e3){console.error("Anti-crash triggered in Wall enemy positioning");break}if(r++,0===this.direction){if(this.y-=e,!(this.y<this.top()+t))break;e=this.top()+t-this.y,this.y=this.top()+t,this.direction=this.rotate(this.direction,this.moveClockwise)}else if(1===this.direction){if(this.x+=e,!(this.x>this.right()-t))break;e=this.x-(this.right()-t),this.x=this.right()-t,this.direction=this.rotate(this.direction,this.moveClockwise)}else if(2===this.direction){if(this.y+=e,!(this.y>this.bottom()-t))break;e=this.y-(this.bottom()-t),this.y=this.bottom()-t,this.direction=this.rotate(this.direction,this.moveClockwise)}else if(3===this.direction){if(this.x-=e,!(this.x<this.left()+t))break;e=this.left()+t-this.x,this.x=this.left()+t,this.direction=this.rotate(this.direction,this.moveClockwise)}}}},{key:"update",value:function(e,t,r){this.prevX=this.x,this.prevY=this.y;var n=Date.now(),i=(n-this.lastUpdateTime)/16.67;this.lastUpdateTime=n;var o=this.x+this.vx*i,a=this.y+this.vy*i,s=this.radius;0===this.direction&&a<this.top()+s?(this.y=this.top()+s,this.direction=this.rotate(this.direction,this.moveClockwise),this.applySpeed()):1===this.direction&&o>this.right()-s?(this.x=this.right()-s,this.direction=this.rotate(this.direction,this.moveClockwise),this.applySpeed()):2===this.direction&&a>this.bottom()-s?(this.y=this.bottom()-s,this.direction=this.rotate(this.direction,this.moveClockwise),this.applySpeed()):3===this.direction&&o<this.left()+s?(this.x=this.left()+s,this.direction=this.rotate(this.direction,this.moveClockwise),this.applySpeed()):(this.x=o,this.y=a),t.update(this)}},{key:"serialize",value:function(){var e,r,n;return o(o({},(e=t,r=this,"function"==typeof(n=u(h(1&3?e.prototype:e),"serialize",r))?function(e){return n.apply(r,e)}:n)([])),{},{direction:this.direction,moveClockwise:this.moveClockwise,boundary:this.boundary})}}],i&&s(r.prototype,i),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i}(r(110).Enemy);e.exports={Wall:p}},229:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function o(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var a=r(903).v4,s=r(110).MS_PER_GAME_TICK,l=function(){function e(t,r,n,i,o,s){var l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:100;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="recursive_bullet_".concat(a()),this.x=t,this.y=r,this.prevX=t,this.prevY=r,this.radius=o,this.speed=s,this.color="#AD85FF",this.outlineColor="#5D2E8C",this.recursionLevel=l,this.lifespan=c,this.ticksLived=0,this.hasFired=!1,this.fireDelay=15;var u=n-t,h=i-r,f=u*u+h*h;if(f>0){var p=Math.sqrt(f);this.vx=u/p*s,this.vy=h/p*s}else this.vx=0,this.vy=-s;this.lastUpdateTime=Date.now(),this.isActive=!0,this._collisionShape={id:this.id,x:0,y:0,radius:this.radius}}return t=e,(r=[{key:"update",value:function(e,t,r){if(this.isActive){if(this.ticksLived++,this.recursionLevel>0&&!this.hasFired&&this.ticksLived>=this.fireDelay&&this.spawnChildBullets(t,r),this.ticksLived>=this.lifespan)return this.isActive=!1,void this.removeFromGrid(t);var n=Date.now(),i=(n-this.lastUpdateTime)/s;this.lastUpdateTime=n,this.prevX=this.x,this.prevY=this.y;var o=this.x+this.vx*i,a=this.y+this.vy*i;if(this._collisionShape.x=o,this._collisionShape.y=a,this._collisionShape.radius=this.radius,t.checkWallCollision(this._collisionShape)||t.checkSafeZoneCollision(this._collisionShape)||t.checkTeleporterCollision(this._collisionShape)||o-this.radius<0||o+this.radius>e.width*e.tileSize||a-this.radius<0||a+this.radius>e.height*e.tileSize)return this.isActive=!1,void this.removeFromGrid(t);this.x=o,this.y=a,t.update(this)}}},{key:"spawnChildBullets",value:function(t,r){if(r&&r.mapBullets&&r.currentMapId){this.hasFired=!0;var n=this.recursionLevel-1,i=.8*this.radius,o=.9*this.speed,a=this.x+5*this.vx,s=this.y+5*this.vy,l=new e(this.x,this.y,a,s,i,o,n,.8*this.lifespan),c=r.mapBullets.get(r.currentMapId)||new Map;c.set(l.id,l),r.mapBullets.set(r.currentMapId,c),l.addToGrid(t)}}},{key:"serialize",value:function(){return{id:this.id,x:this.x,y:this.y,prevX:this.prevX,prevY:this.prevY,radius:this.radius,isActive:this.isActive,recursionLevel:this.recursionLevel}}},{key:"addToGrid",value:function(e){e.insert(this)}},{key:"removeFromGrid",value:function(e){e.remove(this.id)}}])&&i(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r}();e.exports={RecursiveBullet:l}},252:e=>{"use strict";e.exports=require("express")},273:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return(t=c(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function c(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}function h(e,t,r,n){var i=f(p(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof i?function(e){return i.apply(r,e)}:i}function f(){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},f.apply(null,arguments)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}var d=function(e){function t(e,r,i,o){var a,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.05,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:200;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=function(e,t,r){return t=p(t),function(e,t){if(t&&("object"==n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,u()?Reflect.construct(t,r||[],p(e).constructor):t.apply(e,r))}(this,t,[e,r,i,o,4])).increment=s,a.homeRangeSq=l*l,a.angle=Math.atan2(a.vy,a.vx),a.targetAngle=a.angle,a.lastUpdateTimeMs=Date.now(),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}(t,e),r=t,(i=[{key:"update",value:function(e,r,n){var i=Date.now(),o=i-this.lastUpdateTimeMs;this.lastUpdateTimeMs=i,this.behavior(o,n,e),h(t,"update",this,3)([e,r])}},{key:"behavior",value:function(e,t,r){this.angle=Math.atan2(this.vy,this.vx);var n=this.findClosestPlayer(t,r);if(n){var i=n.x-this.x,o=n.y-this.y;this.targetAngle=Math.atan2(o,i)}var a=Math.atan2(Math.sin(this.targetAngle-this.angle),Math.cos(this.targetAngle-this.angle)),s=this.increment*(e/(1e3/60));Math.abs(a)>=.01&&(this.angle+=Math.sign(a)*Math.min(Math.abs(a),s)),this.vx=Math.cos(this.angle)*this.speed,this.vy=Math.sin(this.angle)*this.speed}},{key:"findClosestPlayer",value:function(e,t){if(!e||!e.players)return null;var r,n=null,i=this.homeRangeSq,o=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw o}}}}(e.players.values());try{for(o.s();!(r=o.n()).done;){var a=r.value;if(!a.isDead&&a.currentMapId===e.currentMapId&&!this.isPlayerInProtectedTile(a,e,t)){var l=a.x-this.x,c=a.y-this.y,u=l*l+c*c;u<i&&(i=u,n=a)}}}catch(e){o.e(e)}finally{o.f()}return n}},{key:"isPlayerInProtectedTile",value:function(e,t,r){if(!e||!t)return!0;var n=r||t.mapManager.getMapById(e.currentMapId);if(!n)return!0;var i=Math.floor(e.x/n.tileSize),o=Math.floor(e.y/n.tileSize),a=n.getTileType(i,o);return 2===a||3===a||4===a}},{key:"serialize",value:function(){return o(o({},h(t,"serialize",this,3)([])),{},{homeRange:Math.sqrt(this.homeRangeSq),angle:this.angle,targetAngle:this.targetAngle})}}])&&l(r.prototype,i),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i}(r(110).Enemy);e.exports={Homing:d}},283:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return(t=c(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function c(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}function h(e,t,r,n){var i=f(p(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof i?function(e){return i.apply(r,e)}:i}function f(){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},f.apply(null,arguments)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}var d=function(e){function t(e,r,i,o){var a,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.05,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:200;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=function(e,t,r){return t=p(t),function(e,t){if(t&&("object"==n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,u()?Reflect.construct(t,r||[],p(e).constructor):t.apply(e,r))}(this,t,[e,r,i,o,5])).increment=s,a.homeRangeSq=l*l,a.normal_speed=o,a.base_speed=a.normal_speed,a.prepare_speed=a.normal_speed/4,a.lurch_speed=a.normal_speed,a.time_preparing=0,a.time_lurching=0,a.time_since_last_lurch=0,a.time_to_lurch=300,a.time_between_lurches=0,a.time_to_prepare=300,a.angle=Math.atan2(a.vy,a.vx),a.targetAngle=a.angle,a.lastUpdateTimeMs=Date.now(),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}(t,e),r=t,(i=[{key:"update",value:function(e,r,n){var i=Date.now(),o=i-this.lastUpdateTimeMs;this.lastUpdateTimeMs=i,this.behavior(o,n,e),h(t,"update",this,3)([e,r])}},{key:"behavior",value:function(e,t,r){0===this.time_preparing?0===this.time_lurching?this.time_since_last_lurch<this.time_between_lurches?this.time_since_last_lurch+=e:(this.time_since_last_lurch=0,this.time_preparing+=e,this.base_speed=this.prepare_speed):(this.time_lurching+=e,this.time_lurching>=this.time_to_lurch?(this.time_lurching=0,this.base_speed=this.normal_speed):this.base_speed=this.lurch_speed*(1-Math.pow(this.time_lurching/this.time_to_lurch,5))):(this.time_preparing+=e,this.time_preparing>=this.time_to_prepare?(this.time_preparing=0,this.time_lurching+=e,this.base_speed=this.lurch_speed):this.base_speed=this.prepare_speed*(1-this.time_preparing/this.time_to_prepare)),this.compute_speed(),this.angle=Math.atan2(this.vy,this.vx);var n=this.findClosestPlayer(t,r);if(n){var i=n.x-this.x,o=n.y-this.y;this.targetAngle=Math.atan2(o,i)}var a=Math.atan2(Math.sin(this.targetAngle-this.angle),Math.cos(this.targetAngle-this.angle)),s=this.increment*(e/(1e3/60));Math.abs(a)>=.01&&(this.angle+=Math.sign(a)*Math.min(Math.abs(a),s)),this.vx=Math.cos(this.angle)*this.speed,this.vy=Math.sin(this.angle)*this.speed}},{key:"compute_speed",value:function(){this.speed=Math.max(0,this.base_speed)}},{key:"findClosestPlayer",value:function(e,t){if(!e||!e.players)return null;var r,n=null,i=this.homeRangeSq,o=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw o}}}}(e.players.values());try{for(o.s();!(r=o.n()).done;){var a=r.value;if(!a.isDead&&a.currentMapId===e.currentMapId&&!this.isPlayerInProtectedTile(a,e,t)){var l=a.x-this.x,c=a.y-this.y,u=l*l+c*c;u<i&&(i=u,n=a)}}}catch(e){o.e(e)}finally{o.f()}return n}},{key:"isPlayerInProtectedTile",value:function(e,t,r){if(!e||!t)return!0;var n=r||t.mapManager.getMapById(e.currentMapId);if(!n)return!0;var i=Math.floor(e.x/n.tileSize),o=Math.floor(e.y/n.tileSize),a=n.getTileType(i,o);return 2===a||3===a||4===a}},{key:"serialize",value:function(){return o(o({},h(t,"serialize",this,3)([])),{},{time_preparing:this.time_preparing,time_lurching:this.time_lurching,time_since_last_lurch:this.time_since_last_lurch,angle:this.angle,targetAngle:this.targetAngle})}}])&&l(r.prototype,i),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i}(r(110).Enemy);e.exports={VoidCrawler:d}},329:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],l=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=a(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function a(e,t){if(e){if("string"==typeof e)return s(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function c(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var u=r(903).v4,h=r(612),f=function(){return e=function e(t,r,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=u(),this.name=o||"Player ".concat(this.id.substring(0,4)),this.x=t,this.y=r,this.radius=n,this.color=i,this.originalColor=i,this.vx=0,this.vy=0,this.maxSpeed=10,this.originalMaxSpeed=this.maxSpeed,this.targetX=t,this.targetY=r,this.lastUpdateTime=Date.now(),this.input=null,this.dirX=0,this.dirY=0,this.angle=0,this.distance=0,this.mouseActive=!1,this.d_x=0,this.d_y=0,this.slippery=!1,this.collisionCache=new Map,this.MAX_COLLISION_CACHE_SIZE=1e3,this.COLLISION_CACHE_EVICTION_COUNT=100,this.stuckCounter=0,this.lastPosition={x:t,y:r},this.isDead=!1,this.currentMapId=null,this.needsToExitTeleporterArea=null,this.justTeleportedFlag=!1,this.TELEPORT_GRACE_DURATION=100,this.lastTeleportTimestamp=0,this.collider=new h.Circle(new h.Vector(t,r),n),this.response=new h.Response},(t=[{key:"setInput",value:function(e){this.input=e,this.setupInputHandlers()}},{key:"setupInputHandlers",value:function(){var e=this;this.input&&(this.input.on("movement",(function(t){e.dirX=t.dirX,e.dirY=t.dirY,e.angle=t.angle,e.distance=t.distance,e.mouseActive=t.mouseActive,e.d_x=t.d_x,e.d_y=t.d_y})),this.input.on("movementUpdate",(function(t){e.d_x=t.d_x,e.d_y=t.d_y,e.angle=t.angle,e.slippery=t.slippery})),this.input.on("mousemove",(function(t,r){e.targetX=t,e.targetY=r})))}},{key:"getTilesInBoundingBox",value:function(e,t,r,n,i){for(var o=[],a=i.tileSize,s=Math.floor(e/a),l=Math.floor((e+r)/a),c=Math.floor(t/a),u=Math.floor((t+n)/a),h=c;h<=u;h++)for(var f=s;f<=l;f++)f>=0&&f<i.width&&h>=0&&h<i.height&&o.push({tx:f,ty:h,x:f*a,y:h*a,width:a,height:a});return o}},{key:"update",value:function(e,t){if(t.mapGrids.get(this.currentMapId)){var r=Date.now(),n=(r-this.lastUpdateTime)/16.67;if(n>3&&(n=3),this.lastUpdateTime=r,this.isDead)return this.vx=0,void(this.vy=0);if(this.lastPosition.x=this.x,this.lastPosition.y=this.y,this.justTeleportedFlag&&r-this.lastTeleportTimestamp>this.TELEPORT_GRACE_DURATION&&(this.justTeleportedFlag=!1),this.justTeleportedFlag)this.vx=0,this.vy=0,this.collider.pos.x=this.x,this.collider.pos.y=this.y;else{if(this.input)this.vx=this.d_x*this.maxSpeed,this.vy=this.d_y*this.maxSpeed;else{var a=this.targetX-this.x,s=this.targetY-this.y,l=a*a+s*s;if(l>1){var c=Math.sqrt(l),u=Math.min(c/150,1),f=a/c,p=s/c;this.vx=f*this.maxSpeed*u,this.vy=p*this.maxSpeed*u}else this.x=this.targetX,this.y=this.targetY,this.vx=0,this.vy=0}var y=this.vx*n,d=this.vy*n;this.x+=y,this.y+=d,this.collider.pos.x=this.x,this.collider.pos.y=this.y;var v,m=Math.min(this.lastPosition.x,this.x)-this.radius,g=Math.min(this.lastPosition.y,this.y)-this.radius,b=Math.abs(this.x-this.lastPosition.x)+2*this.radius,w=Math.abs(this.y-this.lastPosition.y)+2*this.radius,S=!1,x=o(this.getTilesInBoundingBox(m,g,b,w,e));try{for(x.s();!(v=x.n()).done;){var M=v.value;if(e.isWall(M.tx,M.ty)){var _=new h.Box(new h.Vector(M.x,M.y),M.width,M.height).toPolygon();if(this.response.clear(),h.testCirclePolygon(this.collider,_,this.response)){S=!0;var k=this.response.overlapV;this.x-=k.x,this.y-=k.y,this.collider.pos.x=this.x,this.collider.pos.y=this.y,Math.abs(k.x)>.001&&(this.vx=0),Math.abs(k.y)>.001&&(this.vy=0)}}}}catch(e){x.e(e)}finally{x.f()}this.input&&S&&this.input.setSlippery(!1)}if(this.needsToExitTeleporterArea)if(this.currentMapId!==this.needsToExitTeleporterArea.mapId)this.needsToExitTeleporterArea=null;else{var O=new h.Box(new h.Vector(this.needsToExitTeleporterArea.x,this.needsToExitTeleporterArea.y),this.needsToExitTeleporterArea.width,this.needsToExitTeleporterArea.height).toPolygon();h.testCirclePolygon(this.collider,O)||(this.needsToExitTeleporterArea=null)}if(!this.needsToExitTeleporterArea&&!this.justTeleportedFlag){var T=Math.floor(this.x/e.tileSize),P=Math.floor(this.y/e.tileSize);if(e.isTeleporter&&e.isTeleporter(T,P)){var E=e.getTeleporter(T,P),j=!1;if(e.teleporterLinks&&e.teleporterLinks.length>0){var I,C=this.currentMapId,A=parseInt(C.replace(/[^0-9]/g,""))-1,B=o(e.teleporterLinks);try{for(B.s();!(I=B.n()).done;){var z=i(I.value.fromKey.split(",").map(Number),3),N=z[0],R=z[1],D=z[2];if(N===A&&R===T&&D===P&&t&&"function"==typeof t.handlePlayerTeleport){this.justTeleportedFlag=!0,this.lastTeleportTimestamp=r,t.handlePlayerTeleport(this.id,{tileX:T,tileY:P}),j=!0;break}}}catch(e){B.e(e)}finally{B.f()}}if(!j&&E&&E.code){var G=E.tileX*e.tileSize,Y=E.tileY*e.tileSize,L=E.width||e.tileSize,F=E.height||e.tileSize,U=new h.Box(new h.Vector(G,Y),L,F).toPolygon();this.response.clear(),h.testCirclePolygon(this.collider,U,this.response)&&t&&"function"==typeof t.handlePlayerTeleport&&(this.justTeleportedFlag=!0,this.lastTeleportTimestamp=r,t.handlePlayerTeleport(this.id,E))}}}}}},{key:"collidesWithWall",value:function(e){var t=new h.Box(new h.Vector(e.x,e.y),e.width,e.height).toPolygon();return this.response.clear(),h.testCirclePolygon(this.collider,t,this.response)}},{key:"setTarget",value:function(e,t){this.targetX=e,this.targetY=t}},{key:"getPosition",value:function(){return{x:this.x,y:this.y}}},{key:"hitByEnemy",value:function(){this.isDead||(this.isDead=!0,this.color="#FF0000",this.maxSpeed=0,this.vx=0,this.vy=0)}},{key:"reviveByPlayer",value:function(){this.isDead&&(this.isDead=!1,this.color=this.originalColor,this.maxSpeed=this.originalMaxSpeed)}},{key:"reset",value:function(){this.isDead=!1,this.color=this.originalColor||"#FFFFFF",this.maxSpeed=this.originalMaxSpeed,this.vx=0,this.vy=0,this.stuckCounter=0,this.mouseActive=!1,this.dirX=0,this.dirY=0,this.d_x=0,this.d_y=0,this.collisionCache.clear(),this.needsToExitTeleporterArea=null,this.justTeleportedFlag=!1,this.lastTeleportTimestamp=0,this.collider.pos.x=this.x,this.collider.pos.y=this.y}},{key:"serialize",value:function(){return{id:this.id,x:this.x,y:this.y,radius:this.radius,color:this.color,isDead:this.isDead,currentMapId:this.currentMapId,name:this.name}}}])&&l(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();e.exports={Player:f}},352:e=>{var t;function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function a(e,t,r){return(t=s(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}var l=function(){return e=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=t,this.height=r,this.cellSize=n,this.inverseCellSize=1/n,this.cellsX=Math.ceil(t/n),this.cellsY=Math.ceil(r/n),this.maxCellX=this.cellsX-1,this.maxCellY=this.cellsY-1,this.cellArea=this.cellSize*this.cellSize,this.cells=new Array(this.cellsX*this.cellsY);for(var i=0;i<this.cells.length;++i)this.cells[i]={entities:new Set,isWall:!1,isSafeZone:!1,isTeleporter:!1,teleporterInfo:null,isPlayerSpawnable:!1};this.entities=new Map,this.worldBounds={minX:0,minY:-2,maxX:t,maxY:r}},(t=[{key:"getCellIndex",value:function(e,t){var r=Math.min(this.maxCellX,Math.max(0,~~(e*this.inverseCellSize))),n=Math.min(this.maxCellY,Math.max(0,~~(t*this.inverseCellSize)));return r*this.cellsY+n}},{key:"getCellCoords",value:function(e,t){return{x:Math.min(this.maxCellX,Math.max(0,~~(e*this.inverseCellSize))),y:Math.min(this.maxCellY,Math.max(0,~~(t*this.inverseCellSize)))}}},{key:"initializeMapData",value:function(e){for(var t=this.cells,r=0;r<t.length;r++){var n=t[r];n.isWall=!1,n.isSafeZone=!1,n.isTeleporter=!1,n.teleporterInfo=null,n.isPlayerSpawnable=!1}for(var i=this.inverseCellSize,o=this.maxCellX,a=this.maxCellY,s=this.cellsY,l=e.tileSize,c=0;c<e.height;c++)for(var u=0;u<e.width;u++){var h=e.getTileType(u,c);if(null!=h)for(var f=u*l,p=c*l,y=f+l,d=p+l,v=Math.max(0,Math.min(o,~~(f*i))),m=Math.max(0,Math.min(a,~~(p*i))),g=Math.max(0,Math.min(o,~~((y-1e-4)*i))),b=Math.max(0,Math.min(a,~~((d-1e-4)*i))),w=v;w<=g;w++)for(var S=m;S<=b;S++){var x=t[w*s+S];switch(h){case 0:x.isWall=!0;break;case 2:x.isSafeZone=!0,x.isPlayerSpawnable=!0;break;case 3:x.isTeleporter=!0;var M=e.getTeleporter(u,c);M&&(x.teleporterInfo={tileX:u,tileY:c,code:M.code,mapId:M.mapId});break;case 4:x.isSafeZone=!0}}}}},{key:"insert",value:function(e){var t=e.radius||0,r=e.id,n=Math.max(0,Math.min(this.maxCellX,~~((e.x-t)*this.inverseCellSize))),i=Math.max(0,Math.min(this.maxCellY,~~((e.y-t)*this.inverseCellSize))),o=Math.max(0,Math.min(this.maxCellX,~~((e.x+t)*this.inverseCellSize))),a=Math.max(0,Math.min(this.maxCellY,~~((e.y+t)*this.inverseCellSize))),s=[],l=this.cellsY,c=this.cells;if(o>=n&&a>=i)for(var u=n;u<=o;u++)for(var h=u*l,f=i;f<=a;f++){var p=h+f;c[p].entities.add(r),s.push(p)}return this.entities.set(r,{entity:e,minX:n,minY:i,maxX:o,maxY:a,cellIndices:s}),s}},{key:"remove",value:function(e){var t=this.entities.get(e);if(t){for(var r=this.cells,n=t.cellIndices,i=n.length,o=0;o<i;o++){var a=n[o];r[a]&&r[a].entities.delete(e)}this.entities.delete(e)}}},{key:"update",value:function(e){var t=e.id,r=this.entities.get(t);if(!r)return this.insert(e);var i=r.cellIndices,o=r.minX,a=r.minY,s=r.maxX,l=r.maxY,c=e.radius||0,u=this.cellsY,h=this.cells,f=Math.max(0,Math.min(this.maxCellX,~~((e.x-c)*this.inverseCellSize))),p=Math.max(0,Math.min(this.maxCellY,~~((e.y-c)*this.inverseCellSize))),y=Math.max(0,Math.min(this.maxCellX,~~((e.x+c)*this.inverseCellSize))),d=Math.max(0,Math.min(this.maxCellY,~~((e.y+c)*this.inverseCellSize)));if(f===o&&p===a&&y===s&&d===l)return r.entity=e,i;var v=[];if(y>=f&&d>=p)for(var m=f;m<=y;m++)for(var g=m*u,b=p;b<=d;b++)v.push(g+b);var w,S=new Set(i),x=new Set(v),M=n(S);try{for(M.s();!(w=M.n()).done;){var _=w.value;x.has(_)||h[_]&&h[_].entities.delete(t)}}catch(e){M.e(e)}finally{M.f()}var k,O=n(x);try{for(O.s();!(k=O.n()).done;){var T=k.value;S.has(T)||h[T]&&h[T].entities.add(t)}}catch(e){O.e(e)}finally{O.f()}return r.entity=e,r.minX=f,r.minY=p,r.maxX=y,r.maxY=d,r.cellIndices=v,v}},{key:"getNearbyEntities",value:function(e){var t=this.entities.get(e.id);if(!t)return[];for(var r=new Set,i=e.id,o=this.cells,a=t.cellIndices,s=a.length,l=0;l<s;l++){var c,u=n(o[a[l]].entities);try{for(u.s();!(c=u.n()).done;){var h=c.value;h!==i&&r.add(h)}}catch(e){u.e(e)}finally{u.f()}}return Array.from(r)}},{key:"_checkOverlapWithCellProperty",value:function(e,t,r,n){var i=this.worldBounds,o=i.minX,a=i.minY,s=i.maxX,l=i.maxY;if(e+r<o||e-r>s||t+r<a||t-r>l)return!1;var c=this.inverseCellSize,u=this.cellsY,h=this.cellSize,f=this.cells,p=~~(e*c),y=~~(t*c),d=Math.ceil(r*c),v=Math.max(0,Math.min(this.maxCellX,p-d)),m=Math.max(0,Math.min(this.maxCellY,y-d)),g=Math.max(0,Math.min(this.maxCellX,p+d)),b=Math.max(0,Math.min(this.maxCellY,y+d)),w=e-r,S=t-r,x=e+r,M=t+r,_=p*u+y;if(_>=0&&_<f.length){var k=f[_];if(k&&n(k))return!0}for(var O=v;O<=g;O++)for(var T=O*u,P=m;P<=b;P++){var E=T+P;if(E!==_){var j=f[E];if(j&&n(j)){var I=O*h,C=P*h;if(w<I+h&&x>I&&S<C+h&&M>C)return!0}}}return!1}},{key:"checkWallCollision",value:function(e){var t=e.radius||0,r=this.worldBounds,n=r.minX,i=r.minY,o=r.maxX,a=r.maxY;return e.x-t<n||e.x+t>o||e.y-t<i||e.y+t>a||this._checkOverlapWithCellProperty(e.x,e.y,t,(function(e){return e.isWall}))}},{key:"checkSafeZoneCollision",value:function(e){return this._checkOverlapWithCellProperty(e.x,e.y,e.radius||0,(function(e){return e.isSafeZone}))}},{key:"queryArea",value:function(e,t,r){var n=r||0,i=this.inverseCellSize,o=this.cellsY,a=Math.max(0,Math.min(this.maxCellX,~~((e-n)*i))),s=Math.max(0,Math.min(this.maxCellY,~~((t-n)*i))),l=Math.max(0,Math.min(this.maxCellX,~~((e+n)*i))),c=Math.max(0,Math.min(this.maxCellY,~~((t+n)*i))),u=new Set,h=this.cells;if(l>=a&&c>=s)for(var f=a;f<=l;f++)for(var p=f*o,y=s;y<=c;y++)h[p+y].entities.forEach((function(e){return u.add(e)}));return Array.from(u)}},{key:"clear",value:function(){for(var e=this.cells.length,t=0;t<e;t++)this.cells[t].entities.clear();this.entities.clear()}},{key:"getGridStats",value:function(){for(var e=this.entities.size,t=0,r=0,n=this.cells.length,i=0;i<n;i++){var o=this.cells[i].entities.size;o>0&&(t++,o>r&&(r=o))}return{totalEntities:e,occupiedCells:t,maxEntitiesInCell:r,totalCells:this.cellsX*this.cellsY}}},{key:"bulkInsert",value:function(e){if(e&&0!==e.length){for(var t=new Set,r=e.length,n=0;n<r;n++){var i=e[n].id;t.add(i),this.entities.has(i)&&this.remove(i)}for(var o=0;o<r;o++)this.insert(e[o])}}},{key:"isValidSpawnPosition",value:function(e,t,r){var n=r||0,i=this.worldBounds,o=i.minX,a=i.minY,s=i.maxX,l=i.maxY;return!(e-n<o||e+n>s||t-n<a||t+n>l||this._checkOverlapWithCellProperty(e,t,n,(function(e){return e.isWall||e.isSafeZone||e.isTeleporter})))}},{key:"checkTeleporterCollision",value:function(e){return this._checkOverlapWithCellProperty(e.x,e.y,e.radius||0,(function(e){return e.isTeleporter}))}},{key:"getTeleporterAt",value:function(e,t){var r=this.getCellIndex(e,t),n=this.cells[r];return n&&n.isTeleporter&&n.teleporterInfo?n.teleporterInfo:null}},{key:"isFullyOutsideTeleporter",value:function(e){return!this.checkTeleporterCollision(e)}},{key:"isFullyInsideTeleporter",value:function(e){var t=this.getTeleporterAt(e.x,e.y);if(!t)return!1;for(var r=e.x,n=e.y,i=e.radius||0,o=t.code,a=this.inverseCellSize,s=this.cellsY,l=Math.max(0,Math.min(this.maxCellX,~~((r-i)*a))),c=Math.max(0,Math.min(this.maxCellY,~~((n-i)*a))),u=Math.max(0,Math.min(this.maxCellX,~~((r+i)*a))),h=Math.max(0,Math.min(this.maxCellY,~~((n+i)*a))),f=Math.pow(i+Math.sqrt(2)*(this.cellSize/2),2),p=l;p<=u;p++)for(var y=p*s,d=c;d<=h;d++){var v=(p+.5)*this.cellSize,m=(d+.5)*this.cellSize;if(!(Math.pow(v-r,2)+Math.pow(m-n,2)>f)){var g=y+d;if(!(g<0||g>=this.cells.length)){var b=this.cells[g];if(!b.isTeleporter||!b.teleporterInfo||b.teleporterInfo.code!==o)return!1}}}return!0}}])&&o(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();t=l,a(l,"NUM_POINTS_8",8),a(l,"ANGLES_COS_8",[]),a(l,"ANGLES_SIN_8",[]),a(l,"NUM_POINTS_12",12),a(l,"ANGLES_COS_12",[]),a(l,"ANGLES_SIN_12",[]),function(){for(var e=0;e<t.NUM_POINTS_8;e++){var r=e/t.NUM_POINTS_8*Math.PI*2;t.ANGLES_COS_8.push(Math.cos(r)),t.ANGLES_SIN_8.push(Math.sin(r))}for(var n=0;n<t.NUM_POINTS_12;n++){var i=n/t.NUM_POINTS_12*Math.PI*2;t.ANGLES_COS_12.push(Math.cos(i)),t.ANGLES_SIN_12.push(Math.sin(i))}}(),e.exports&&(e.exports=l)},356:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function o(){"use strict";o=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",l=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r,n){return Object.defineProperty(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function h(t,r,n,i){var o=r&&r.prototype instanceof y?r:y,a=Object.create(o.prototype);return u(a,"_invoke",function(t,r,n){var i=1;return function(o,a){if(3===i)throw Error("Generator is already running");if(4===i){if("throw"===o)throw a;return{value:e,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var l=M(s,n);if(l){if(l===p)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===i)throw i=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=3;var c=f(t,r,n);if("normal"===c.type){if(i=n.done?4:2,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=4,n.method="throw",n.arg=c.arg)}}}(t,n,new O(i||[])),!0),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p={};function y(){}function d(){}function v(){}var m={};u(m,s,(function(){return this}));var g=Object.getPrototypeOf,b=g&&g(g(T([])));b&&b!==r&&i.call(b,s)&&(m=b);var w=v.prototype=y.prototype=Object.create(m);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(o,a,s,l){var c=f(e[o],e,a);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==n(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,s,l)}),(function(e){r("throw",e,s,l)})):t.resolve(h).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,l)}))}l(c.arg)}var o;u(this,"_invoke",(function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}),!0)}function M(t,r){var n=r.method,i=t.i[n];if(i===e)return r.delegate=null,"throw"===n&&t.i.return&&(r.method="return",r.arg=e,M(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var o=f(i,t.i,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var a=o.arg;return a?a.done?(r[t.r]=a.value,r.next=t.n,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,p):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function _(e){this.tryEntries.push(e)}function k(t){var r=t[4]||{};r.type="normal",r.arg=e,t[4]=r}function O(e){this.tryEntries=[[-1]],e.forEach(_,this),this.reset(!0)}function T(t){if(null!=t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(i.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return d.prototype=v,u(w,"constructor",v),u(v,"constructor",d),d.displayName=u(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,c,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},S(x.prototype),u(x.prototype,l,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new x(h(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(w),u(w,c,"Generator"),u(w,s,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},t.values=T,O.prototype={constructor:O,reset:function(t){if(this.prev=this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e){a.type="throw",a.arg=t,r.next=e}for(var i=r.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o[4],s=this.prev,l=o[1],c=o[2];if(-1===o[0])return n("end"),!1;if(!l&&!c)throw Error("try statement without catch or finally");if(null!=o[0]&&o[0]<=s){if(s<l)return this.method="next",this.arg=e,n(l),!0;if(s<c)return n(c),!1}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var i=n;break}}i&&("break"===e||"continue"===e)&&i[0]<=t&&t<=i[2]&&(i=null);var o=i?i[4]:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i[2],p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[2]===e)return this.complete(r[4],r[3]),k(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[0]===e){var n=r[4];if("throw"===n.type){var i=n.arg;k(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={i:T(t),r,n},"next"===this.method&&(this.arg=e),p}},t}function a(e,t,r,n,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,i)}function s(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function s(e){a(o,n,i,s,l,"next",e)}function l(e){a(o,n,i,s,l,"throw",e)}s(void 0)}))}}var l=r(106),c=r(149),u=r(422).ENEMY_TYPES;function h(e){return f.apply(this,arguments)}function f(){return(f=s(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Buffer.isBuffer(t)){e.next=23;break}if(9!==t.length||t[0]!==c.BINARY_MESSAGE_MOUSE_MOVE){e.next=3;break}return e.abrupt("return",{type:"m",x:t.readInt32LE(1),y:t.readInt32LE(5)});case 3:return e.prev=3,e.next=6,new Promise((function(e,r){l.gunzip(t,(function(t,n){return t?r(t):e(n.toString("utf8"))}))}));case 6:r=e.sent,e.next=20;break;case 9:return e.prev=9,e.t0=e.catch(3),e.prev=11,e.next=14,new Promise((function(e,r){l.inflate(t,(function(t,n){return t?r(t):e(n.toString("utf8"))}))}));case 14:r=e.sent,e.next=20;break;case 17:e.prev=17,e.t1=e.catch(11),r=t.toString("utf8");case 20:return e.abrupt("return",JSON.parse(r));case 23:return e.abrupt("return",JSON.parse(t.toString("utf8")));case 24:case"end":return e.stop()}}),e,null,[[3,9],[11,17]])})))).apply(this,arguments)}function p(e,t,r,n){e.updatePlayerDirection(t,r,n)}function y(e,t){var r=JSON.stringify({type:"pong",clientTime:t,serverTime:Date.now()});e.send(r)}function d(e,t,r,n,i){if(r.currentMapId)if(!n||"/reset"!==n.trim()&&"/r"!==n.trim()){if(n&&n.trim().startsWith("/tp "))!function(e,t,r,n,i){v.apply(this,arguments)}(e,t,r,n.trim(),i);else if(n){var o={type:"chat",sender:r.name,message:n.substring(0,c.MAX_CHAT_MESSAGE_LENGTH)},a=JSON.stringify(o);t.send(a),i(a,t)}}else!function(e,t,r){m.apply(this,arguments)}(e,t,r)}function v(){return(v=s(o().mark((function e(t,r,n,a,s){var l,c,u,h,f,p,y,d,v,m,g,b,w,S,x,M,_,k;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.name.toLowerCase().includes("admin")){e.next=4;break}return l=JSON.stringify({type:"chat",sender:"[SERVER]",message:"You do not have permission to use this command.",color:"#ff6666"}),r.send(l),e.abrupt("return");case 4:if(2===(c=a.split(" ")).length){e.next=9;break}return u=JSON.stringify({type:"chat",sender:"[SERVER]",message:"Usage: /tp map1 (replace 1 with desired map number)",color:"#ff6666"}),r.send(u),e.abrupt("return");case 9:if(h=c[1],f=t.mapManager.getMapById(h)){e.next=15;break}return p=JSON.stringify({type:"chat",sender:"[SERVER]",message:"Map ".concat(h," not found. Available maps: map1-map10"),color:"#ff6666"}),r.send(p),e.abrupt("return");case 15:return e.prev=15,e.next=18,t.loadMapIfNeeded(h);case 18:for(y=[],d=0;d<f.height;d++)for(v=0;v<f.width;v++)4===f.getTileType(v,d)&&y.push({x:v*f.tileSize+f.tileSize/2,y:d*f.tileSize+f.tileSize/2});if(0===y.length)for(m=0;m<f.height;m++)for(g=0;g<f.width;g++)2===f.getTileType(g,m)&&y.push({x:g*f.tileSize+f.tileSize/2,y:m*f.tileSize+f.tileSize/2});if(0!==y.length){e.next=25;break}return b=JSON.stringify({type:"chat",sender:"[SERVER]",message:"No safe zones found on map ".concat(h," for teleportation."),color:"#ff6666"}),r.send(b),e.abrupt("return");case 25:return w=y[Math.floor(Math.random()*y.length)],S=Array.from(t.players.entries()),x=S.length,M=S.map((function(e){var r,n,o=(n=2,function(e){if(Array.isArray(e))return e}(r=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],l=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(r,n)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0];return o[1],t.forcePlayerToMapPosition(a,h,w.x,w.y)})),e.next=31,Promise.all(M);case 31:_=JSON.stringify({type:"chat",sender:"[SERVER]",message:"".concat(n.name," teleported everyone to ").concat(h,"!"),color:"#ffceb7"}),s(_),console.log("Player ".concat(n.id," (").concat(n.name,") teleported ").concat(x," players to ").concat(h)),e.next=41;break;case 36:e.prev=36,e.t0=e.catch(15),console.error("Error during mass teleport to ".concat(h,":"),e.t0),k=JSON.stringify({type:"chat",sender:"[SERVER]",message:"Error teleporting to ".concat(h,": ").concat(e.t0.message),color:"#ff6666"}),r.send(k);case 41:case"end":return e.stop()}}),e,null,[[15,36]])})))).apply(this,arguments)}function m(){return(m=s(o().mark((function e(t,r,n){var i,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=c.DEFAULT_MAP_ID,a=t.mapManager.getMapById(i)){e.next=6;break}return console.error("/reset: Default map ".concat(i," not found.")),r.send(JSON.stringify({type:"error",message:"Reset failed: Default map not found."})),e.abrupt("return");case 6:return e.prev=6,e.next=9,t.loadMapIfNeeded(i);case 9:e.next=16;break;case 11:return e.prev=11,e.t0=e.catch(6),console.error("/reset: Failed to load default map ".concat(i," for player ").concat(n.id,":"),e.t0),r.send(JSON.stringify({type:"error",message:"Reset failed: Could not load default map."})),e.abrupt("return");case 16:if(!(s=a.getRandomTypePosition(2))){e.next=24;break}return n.reset(),e.next=21,t.forcePlayerToMapPosition(n.id,i,s.x,s.y);case 21:r.send(JSON.stringify({type:"respawn",id:n.id,x:n.x,y:n.y,currentMapId:n.currentMapId})),e.next=26;break;case 24:console.error("/reset: No spawn point of type 2 found on default map ".concat(i,".")),r.send(JSON.stringify({type:"error",message:"Reset failed: No spawn point available on default map."}));case 26:case"end":return e.stop()}}),e,null,[[6,11]])})))).apply(this,arguments)}function g(e,t,r,n,i){return b.apply(this,arguments)}function b(){return(b=s(o().mark((function e(t,r,n,i,a){var s,h,f,p,y,d,v,m,g;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.currentMapId){e.next=3;break}return console.warn("Player ".concat(n.id," sent joinGame but already in map ").concat(n.currentMapId)),e.abrupt("return");case 3:if(n.name=i.substring(0,16),s=c.DEFAULT_MAP_ID,e.prev=5,h=t.mapManager.getMapById(s)){e.next=10;break}return r.close(1011,"Server error: Default map not available."),e.abrupt("return");case 10:return e.next=12,t.loadMapIfNeeded(s);case 12:if(f=h.getRandomTypePosition(2)){e.next=16;break}return r.close(1011,"Server error: No spawn on default map."),e.abrupt("return");case 16:return n.x=f.x,n.y=f.y,n.targetX=f.x,n.targetY=f.y,e.next=22,t.addPlayer(n,r,s);case 22:if(p=t.mapManager.getMapById(n.currentMapId)){e.next=28;break}return e.next=26,t.removePlayer(n.id);case 26:return r.close(1011,"Server error: map data unavailable for player post-join."),e.abrupt("return");case 28:y=t.mapEnemies.get(n.currentMapId)||new Map,d=Array.from(y.values()).map((function(e){return e.serialize()})),v=JSON.stringify({type:"init",id:n.id,map:p.tiles,mapWidth:p.width,mapHeight:p.height,tileSize:p.tileSize,enemyTypes:u,enemies:d,playerData:n.serialize(),status:"joined"}),t._idMapNeedsUpdate=!0,m=l.gzipSync(Buffer.from(v)),r.send(m,{binary:!0}),g=JSON.stringify({type:"chat",sender:"[SERVER]",message:"Welcome to Eluding! Type /reset or /r in chat to respawn.",color:"#ffceb7"}),r.send(g),console.log("Player ".concat(n.name," (").concat(n.id,") joined game on map ").concat(n.currentMapId,".")),e.next=52;break;case 39:if(e.prev=39,e.t0=e.catch(5),console.error("Error during player join game for ".concat(n.id,":"),e.t0),!n.id||!n.currentMapId){e.next=51;break}return e.prev=43,e.next=46,t.removePlayer(n.id);case 46:e.next=51;break;case 48:e.prev=48,e.t1=e.catch(43),console.error("Error removing player during join failure:",e.t1);case 51:r.readyState!==WebSocket.OPEN&&r.readyState!==WebSocket.CONNECTING||r.close(1011,"Server error during game join.");case 52:case"end":return e.stop()}}),e,null,[[5,39],[43,48]])})))).apply(this,arguments)}function w(){return(w=s(o().mark((function e(t,r,n,i,a){var s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h(i);case 3:if(s=e.sent,n.currentMapId||"joinGame"===s.type||"ping"===s.type||"requestIdMap"===s.type){e.next=7;break}return"ping"===s.type?y(r,s.time):console.warn("Player ".concat(n.id," sent message type ").concat(s.type," before joining game.")),e.abrupt("return");case 7:if("joinGame"!==s.type){e.next=17;break}if(!s.name||"string"!=typeof s.name){e.next=13;break}return e.next=11,g(t,r,n,s.name,a);case 11:e.next=15;break;case 13:console.warn("Player ".concat(n.id," sent invalid joinGame message.")),r.close(1003,"Invalid join game message.");case 15:e.next=18;break;case 17:"m"===s.type?p(t,n.id,s.x,s.y):"ping"===s.type?y(r,s.time):"requestIdMap"===s.type?t._idMapNeedsUpdate=!0:"chat"===s.type&&d(t,r,n,s.message,a);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),console.error("Failed to parse or handle message:",e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,20]])})))).apply(this,arguments)}e.exports={handlePlayerMessage:function(e,t,r,n,i){return w.apply(this,arguments)},parseMessageContents:h}},360:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return(t=c(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function c(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}function h(e,t,r,n){var i=f(p(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof i?function(e){return i.apply(r,e)}:i}function f(){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},f.apply(null,arguments)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}var d=r(110).Enemy,v=r(229).RecursiveBullet,m=function(e){function t(e,r,i,o){var a,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:120,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:4,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=function(e,t,r){return t=p(t),function(e,t){if(t&&("object"==n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,u()?Reflect.construct(t,r||[],p(e).constructor):t.apply(e,r))}(this,t,[e,r,i,o,7])).color="#AD85FF",a.outlineColor="#5D2E8C",a.shootCooldown=0,a.maxShootCooldown=s,a.bulletRadius=l,a.bulletSpeed=c,a.recursionLevels=h,a.rotationAngle=0,a.rotationSpeed=.03,a.lastUpdateTimeMs=Date.now(),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}(t,e),r=t,(i=[{key:"update",value:function(e,r,n){h(t,"update",this,3)([e,r]);var i=Date.now();this.lastUpdateTimeMs,this.lastUpdateTimeMs=i,this.rotationAngle+=this.rotationSpeed,this.rotationAngle>2*Math.PI&&(this.rotationAngle-=2*Math.PI),this.shootCooldown>0&&this.shootCooldown--,n&&0===this.shootCooldown&&this.hasTargetablePlayer(n,e)&&(this.fireSpiral(6,r,n),this.shootCooldown=this.maxShootCooldown)}},{key:"hasTargetablePlayer",value:function(e,t){if(!e||!e.players)return!1;var r,n=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw o}}}}(e.players.values());try{for(n.s();!(r=n.n()).done;){var i=r.value;if(!i.isDead&&i.currentMapId===e.currentMapId&&!this.isPlayerInProtectedTile(i,e,t))return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"isPlayerInProtectedTile",value:function(e,t,r){if(!e||!t)return!0;var n=r||t.mapManager.getMapById(e.currentMapId);if(!n)return!0;var i=Math.floor(e.x/n.tileSize),o=Math.floor(e.y/n.tileSize),a=n.getTileType(i,o);return 2===a||3===a||4===a}},{key:"fireSpiral",value:function(e,t,r){if(r&&r.mapBullets&&r.currentMapId)for(var n=0;n<e;n++){var i=this.rotationAngle+2*Math.PI/e*n,o=this.x+100*Math.cos(i),a=this.y+100*Math.sin(i),s=new v(this.x,this.y,o,a,this.bulletRadius,this.bulletSpeed,this.recursionLevels,200),l=r.mapBullets.get(r.currentMapId)||new Map;l.set(s.id,s),r.mapBullets.set(r.currentMapId,l),s.addToGrid(t)}}},{key:"serialize",value:function(){return o(o({},h(t,"serialize",this,3)([])),{},{shootCooldown:this.shootCooldown,maxShootCooldown:this.maxShootCooldown,recursionLevels:this.recursionLevels,rotationAngle:this.rotationAngle})}}])&&l(r.prototype,i),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i}(d);e.exports={RecursiveBulletBoss:m}},417:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(){"use strict";i=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",l=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r,n){return Object.defineProperty(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function h(t,r,n,i){var o=r&&r.prototype instanceof y?r:y,a=Object.create(o.prototype);return u(a,"_invoke",function(t,r,n){var i=1;return function(o,a){if(3===i)throw Error("Generator is already running");if(4===i){if("throw"===o)throw a;return{value:e,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var l=M(s,n);if(l){if(l===p)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===i)throw i=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=3;var c=f(t,r,n);if("normal"===c.type){if(i=n.done?4:2,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=4,n.method="throw",n.arg=c.arg)}}}(t,n,new O(i||[])),!0),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p={};function y(){}function d(){}function v(){}var m={};u(m,s,(function(){return this}));var g=Object.getPrototypeOf,b=g&&g(g(T([])));b&&b!==r&&o.call(b,s)&&(m=b);var w=v.prototype=y.prototype=Object.create(m);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(i,a,s,l){var c=f(e[i],e,a);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==n(h)&&o.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,s,l)}),(function(e){r("throw",e,s,l)})):t.resolve(h).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,l)}))}l(c.arg)}var i;u(this,"_invoke",(function(e,n){function o(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(o,o):o()}),!0)}function M(t,r){var n=r.method,i=t.i[n];if(i===e)return r.delegate=null,"throw"===n&&t.i.return&&(r.method="return",r.arg=e,M(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var o=f(i,t.i,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var a=o.arg;return a?a.done?(r[t.r]=a.value,r.next=t.n,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,p):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function _(e){this.tryEntries.push(e)}function k(t){var r=t[4]||{};r.type="normal",r.arg=e,t[4]=r}function O(e){this.tryEntries=[[-1]],e.forEach(_,this),this.reset(!0)}function T(t){if(null!=t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(o.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return d.prototype=v,u(w,"constructor",v),u(v,"constructor",d),d.displayName=u(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,c,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},S(x.prototype),u(x.prototype,l,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new x(h(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(w),u(w,c,"Generator"),u(w,s,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},t.values=T,O.prototype={constructor:O,reset:function(t){if(this.prev=this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e){a.type="throw",a.arg=t,r.next=e}for(var i=r.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o[4],s=this.prev,l=o[1],c=o[2];if(-1===o[0])return n("end"),!1;if(!l&&!c)throw Error("try statement without catch or finally");if(null!=o[0]&&o[0]<=s){if(s<l)return this.method="next",this.arg=e,n(l),!0;if(s<c)return n(c),!1}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var i=n;break}}i&&("break"===e||"continue"===e)&&i[0]<=t&&t<=i[2]&&(i=null);var o=i?i[4]:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i[2],p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[2]===e)return this.complete(r[4],r[3]),k(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[0]===e){var n=r[4];if("throw"===n.type){var i=n.arg;k(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={i:T(t),r,n},"next"===this.method&&(this.arg=e),p}},t}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t,r,n,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,i)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){s(o,n,i,a,l,"next",e)}function l(e){s(o,n,i,a,l,"throw",e)}a(void 0)}))}}var c=r(106),u=r(329).Player,h=r(422).ENEMY_TYPES,f=r(149),p=r(356).handlePlayerMessage;function y(){return y=l(i().mark((function e(t,r,n,a){var s,y,v,g,b,w,S,x,M,_,k,O,T,P,E;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=new u(0,0,25,"#FFFFFF"),e.prev=1,y=f.DEFAULT_MAP_ID,v=n.mapManager.getMapById(y)){e.next=7;break}return t.close(1011,"Server error: Default map not available for spectator mode."),e.abrupt("return");case 7:return e.next=9,n.loadMapIfNeeded(y);case 9:g=n.mapEnemies.get(y)||new Map,b=Array.from(g.values()).map((function(e){return e.serialize()})),w=[],S=o(n.players.values());try{for(S.s();!(x=S.n()).done;)(M=x.value).currentMapId===y&&M.id!==s.id&&w.push(M.serialize())}catch(e){S.e(e)}finally{S.f()}return _=v.width*v.tileSize/2,k=v.height*v.tileSize/2,(O=v.getRandomTypePosition(2))&&(_=O.x,k=O.y),T={type:"init",id:s.id,status:"awaitingName",map:v.tiles,mapWidth:v.width,mapHeight:v.height,tileSize:v.tileSize,enemyTypes:h,enemies:b,players:w,spectatorCameraX:_,spectatorCameraY:k},P=JSON.stringify(T),E=c.gzipSync(Buffer.from(P)),t.send(E,{binary:!0}),n.connections.set(s.id,t),t.on("message",function(){var e=l(i().mark((function e(r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(n,t,s,r,a);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.on("close",l(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d(n,s);case 2:case"end":return e.stop()}}),e)})))),t.on("error",(function(e){m(n,s,e)})),e.abrupt("return",s);case 29:return e.prev=29,e.t0=e.catch(1),console.error("Error during initial connection setup:",e.t0),t.readyState!==WebSocket.OPEN&&t.readyState!==WebSocket.CONNECTING||t.close(1011,"Server error during initial connection setup."),e.abrupt("return",null);case 34:case"end":return e.stop()}}),e,null,[[1,29]])}))),y.apply(this,arguments)}function d(e,t){return v.apply(this,arguments)}function v(){return(v=l(i().mark((function e(t,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r||!r.id){e.next=14;break}if(!r.currentMapId){e.next=12;break}return e.prev=2,e.next=5,t.removePlayer(r.id);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.error("Error removing player on close:",e.t0);case 10:e.next=14;break;case 12:t.connections.delete(r.id),console.log("Pending player ".concat(r.id," disconnected before joining a map. Removed from connections."));case 14:case"end":return e.stop()}}),e,null,[[2,7]])})))).apply(this,arguments)}function m(e,t,r){if(console.error("WebSocket error for player ".concat(t?t.id:"unknown",":"),r),t&&t.id)if(t.currentMapId){var n=e.removePlayer(t.id);n&&"function"==typeof n.then&&n.catch((function(e){return console.error("Error removing player on WebSocket error:",e)}))}else e.connections.delete(t.id),console.log("WebSocket error for pending player ".concat(t.id," before joining a map. Removed from connections."))}e.exports={handleNewConnection:function(e,t,r,n){return y.apply(this,arguments)},handleConnectionClose:d,handleConnectionError:m}},422:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}r(903).v4;var i=r(352),o=r(110).Enemy,a=r(74).Sniper,s=r(854).Dasher,l=r(273).Homing,c=r(283).VoidCrawler,u=r(165).Wall,h=r(833).Bullet,f=r(229).RecursiveBullet,p=r(360).RecursiveBulletBoss,y={1:{name:"Basic",color:"#808080",outlineColor:"#000000"},2:{name:"Sniper",color:"#8B0000",outlineColor:"#000000"},3:{name:"Dasher",color:"#003c66",outlineColor:"#001830"},4:{name:"Homing",color:"#7F00FF",outlineColor:"#5c4200"},5:{name:"VoidCrawler",color:"#1c0a2d",outlineColor:"#0d0517"},6:{name:"Wall",color:"#222222",outlineColor:"#111111"},7:{name:"RecursiveBulletBoss",color:"#AD85FF",outlineColor:"#5D2E8C"}};console.log("Loaded enemy types:",Object.keys(y).join(", ")),console.log("RecursiveBulletBoss loaded:",n(p));var d=null;o.initializeGridWithMap=function(e){var t=e.tileSize||64;return(d=new i(e.width*e.tileSize,e.height*e.tileSize,t)).initializeMapData(e),d},o.bulkAddToGrid=function(e,t){e&&0!==e.length&&t.bulkInsert(e)},e.exports={Enemy:o,Sniper:a,Dasher:s,Homing:l,VoidCrawler:c,Wall:u,RecursiveBulletBoss:p,Bullet:h,RecursiveBullet:f,ENEMY_TYPES:y,initializeGridWithMap:o.initializeGridWithMap,bulkAddToGrid:o.bulkAddToGrid,getGrid:function(){if(!d)throw new Error("Grid accessed before initialization. Call Enemy.initGrid() or Enemy.initializeGridWithMap() first.");return d},MS_PER_GAME_TICK:1e3/60}},476:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,n(i.key),i)}}function n(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}var i=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"decodeMap",value:function(e,t,r){for(var n=[],i=0,o=0,a=0;a<e.length;a+=2){var s=e[a],l=e[a+1];n[i]||(n[i]=[]);for(var c=0;c<l;c++)n[i][o]=s,++o>=t&&(o=0,++i<r&&!n[i]&&(n[i]=[]))}return n}},{key:"encodeMap",value:function(e){for(var t=[],r=null,n=0,i=[],o=0;o<e.length;o++)for(var a=0;a<e[o].length;a++)i.push(e[o][a]);for(var s=0;s<i.length;s++){var l=i[s];l===r?n++:(null!==r&&t.push(r,n),r=l,n=1)}return null!==r&&t.push(r,n),t}}],null&&r(e.prototype,null),t&&r(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();e.exports=i},611:e=>{"use strict";e.exports=require("http")},612:e=>{"use strict";e.exports=require("sat")},654:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],l=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=a(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function a(e,t){if(e){if("string"==typeof e)return s(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(){"use strict";l=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,r,n){return Object.defineProperty(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function h(t,r,n,i){var o=r&&r.prototype instanceof y?r:y,a=Object.create(o.prototype);return u(a,"_invoke",function(t,r,n){var i=1;return function(o,a){if(3===i)throw Error("Generator is already running");if(4===i){if("throw"===o)throw a;return{value:e,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var l=M(s,n);if(l){if(l===p)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===i)throw i=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=3;var c=f(t,r,n);if("normal"===c.type){if(i=n.done?4:2,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=4,n.method="throw",n.arg=c.arg)}}}(t,n,new O(i||[])),!0),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p={};function y(){}function d(){}function v(){}var m={};u(m,a,(function(){return this}));var g=Object.getPrototypeOf,b=g&&g(g(T([])));b&&b!==r&&i.call(b,a)&&(m=b);var w=v.prototype=y.prototype=Object.create(m);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(o,a,s,l){var c=f(e[o],e,a);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==n(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,s,l)}),(function(e){r("throw",e,s,l)})):t.resolve(h).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,l)}))}l(c.arg)}var o;u(this,"_invoke",(function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}),!0)}function M(t,r){var n=r.method,i=t.i[n];if(i===e)return r.delegate=null,"throw"===n&&t.i.return&&(r.method="return",r.arg=e,M(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var o=f(i,t.i,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var a=o.arg;return a?a.done?(r[t.r]=a.value,r.next=t.n,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,p):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function _(e){this.tryEntries.push(e)}function k(t){var r=t[4]||{};r.type="normal",r.arg=e,t[4]=r}function O(e){this.tryEntries=[[-1]],e.forEach(_,this),this.reset(!0)}function T(t){if(null!=t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,s=function r(){for(;++o<t.length;)if(i.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return s.next=s}}throw new TypeError(n(t)+" is not iterable")}return d.prototype=v,u(w,"constructor",v),u(v,"constructor",d),d.displayName=u(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,c,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},S(x.prototype),u(x.prototype,s,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new x(h(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(w),u(w,c,"Generator"),u(w,a,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},t.values=T,O.prototype={constructor:O,reset:function(t){if(this.prev=this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e){a.type="throw",a.arg=t,r.next=e}for(var i=r.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o[4],s=this.prev,l=o[1],c=o[2];if(-1===o[0])return n("end"),!1;if(!l&&!c)throw Error("try statement without catch or finally");if(null!=o[0]&&o[0]<=s){if(s<l)return this.method="next",this.arg=e,n(l),!0;if(s<c)return n(c),!1}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var i=n;break}}i&&("break"===e||"continue"===e)&&i[0]<=t&&t<=i[2]&&(i=null);var o=i?i[4]:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i[2],p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[2]===e)return this.complete(r[4],r[3]),k(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[0]===e){var n=r[4];if("throw"===n.type){var i=n.arg;k(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={i:T(t),r,n},"next"===this.method&&(this.arg=e),p}},t}function c(e,t,r,n,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,i)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){c(o,n,i,a,s,"next",e)}function s(e){c(o,n,i,a,s,"throw",e)}a(void 0)}))}}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var p=r(106),y=r(422),d=(y.Enemy,y.Sniper),v=y.Dasher,m=y.Homing,g=y.VoidCrawler,b=y.Wall,w=(y.Bullet,y.RecursiveBullet,y.ENEMY_TYPES),S=y.initializeGridWithMap,x=y.RecursiveBulletBoss,M=(r(329).Player,r(352).Grid,r(748).EnemySpawner),_=r(789),k=r(149),O=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mapManager=t,this.players=new Map,this.connections=new Map,this.mapEnemies=new Map,this.mapBullets=new Map,this.mapGrids=new Map,this.lastUpdateTime=Date.now(),this.updateInterval=null,this._cachedPlayerIds=new Map,this._cachedEnemyIds=new Map,this._cachedBulletIds=new Map,this._playerIdCounter=1,this._enemyIdCounter=1,this._bulletIdCounter=1,this._idMapNeedsUpdate=!0,this._updateCounter=0,this._unusedMapTimeout=5,this._mapLastAccessed=new Map,this.enemySpawner=new M(this.mapManager,this.mapGrids,this.mapEnemies)},t=[{key:"loadMapIfNeeded",value:(s=u(l().mark((function e(t){var r,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._mapLastAccessed.set(t,Date.now()),this.mapGrids.has(t)&&this.mapEnemies.has(t)){e.next=16;break}if(r=this.mapManager.getMapById(t)){e.next=6;break}return console.error("Failed to load map: ".concat(t,". Map not found.")),e.abrupt("return",null);case 6:return console.log("Loading map resources for ".concat(t,"...")),console.log("Map ".concat(t," teleporter methods available:"),{hasTeleporterManager:!!r.teleporterManager,hasGetTeleporterMethod:"function"==typeof r.getTeleporterByCode}),r.teleporterManager&&console.log("Teleporter codes for map ".concat(t,":"),Array.from(r.teleporterManager.teleportersByCode.keys())),n=S(r),this.mapGrids.set(t,n),this.mapEnemies.set(t,new Map),this.mapBullets.set(t,new Map),this.enemySpawner.spawnEnemiesForMap(t,r,n),console.log("Map resources for ".concat(t," loaded.")),e.abrupt("return",r);case 16:return e.abrupt("return",this.mapManager.getMapById(t));case 17:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"addPlayer",value:(a=u(l().mark((function e(t,r){var n,i=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:"map1",t.currentMapId=n,e.next=4,this.loadMapIfNeeded(n);case 4:this.players.set(t.id,t),this.connections.set(t.id,r),this.broadcastNewPlayer(t),this._idMapNeedsUpdate=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"removePlayer",value:function(e){var t=this.players.get(e);t&&(this.players.delete(e),this.connections.delete(e),this._cachedPlayerIds.delete(t.id),this._idMapNeedsUpdate=!0,this.broadcastPlayerLeave(e,t.currentMapId))}},{key:"updatePlayerDirection",value:function(e,t,r){var n=this.players.get(e);n&&n.setTarget(t,r)}},{key:"start",value:function(){var e=this;this.updateInterval=setInterval((function(){return e.update()}),16)}},{key:"stop",value:function(){clearInterval(this.updateInterval)}},{key:"update",value:function(){var e=Date.now();this.lastUpdateTime=e,this._updateCounter%1800==0&&this.cleanupUnusedMaps();var t,r=o(this.players);try{for(r.s();!(t=r.n()).done;){var n=i(t.value,2),a=n[0],s=n[1],l=s.currentMapId,c=this.mapManager.getMapById(l),u=this.mapGrids.get(l);l&&this._mapLastAccessed.set(l,e),c&&u?s.update(c,this):console.warn("Player ".concat(a," on unloaded map ").concat(l,". Skipping update."))}}catch(e){r.e(e)}finally{r.f()}var h,f=o(this.mapEnemies);try{for(f.s();!(h=f.n()).done;){var p=i(h.value,2),y=p[0],w=p[1],S=this.mapManager.getMapById(y),M=this.mapGrids.get(y);if(S&&M){this.currentMapId=y;var _,k=o(w);try{for(k.s();!(_=k.n()).done;){var O=i(_.value,2),T=(O[0],O[1]);T instanceof d||T instanceof v||T instanceof m||T instanceof g||T instanceof b||T instanceof x?T.update(S,M,this):T.update(S,M)}}catch(e){k.e(e)}finally{k.f()}var P,E=this.mapBullets.get(y)||new Map,j=o(E);try{for(j.s();!(P=j.n()).done;){var I=i(P.value,2),C=I[0],A=I[1];A.isActive?A.constructor&&("RecursiveBullet"===A.constructor.name||"string"==typeof A.id&&A.id.startsWith("recursive_bullet_"))?A.update(S,M,this):A.update(S,M):(A.removeFromGrid(M),E.delete(C))}}catch(e){j.e(e)}finally{j.f()}}else console.warn("Skipping enemy updates for unloaded map ".concat(y,"."))}}catch(e){f.e(e)}finally{f.f()}this.checkCollisions(),this.broadcastGameState(),this._updateCounter++,this._updateCounter%1e3==0&&this.cleanupCachedIds()}},{key:"checkCollisions",value:function(){var e,t=new Map,r=o(this.players.values());try{for(r.s();!(e=r.n()).done;){var n=e.value;t.has(n.currentMapId)||t.set(n.currentMapId,[]),t.get(n.currentMapId).push(n)}}catch(e){r.e(e)}finally{r.f()}var a,s=o(t);try{for(s.s();!(a=s.n()).done;){var l=i(a.value,2),c=l[0],u=l[1],h=this.mapGrids.get(c),f=this.mapEnemies.get(c),p=this.mapBullets.get(c)||new Map,y=this.mapManager.getMapById(c);if(h&&f&&y){var d,v=o(u);try{for(v.s();!(d=v.n()).done;){var m=d.value;if(!m.isDead){var g,b=m.radius+30,w=h.queryArea(m.x,m.y,b),S=!1,x=o(w);try{for(x.s();!(g=x.n()).done;){var M=g.value,_=f.get(M);if(_){var k=m.x-_.x,O=m.y-_.y,T=k*k+O*O,P=m.radius+_.radius;if(T<P*P){m.hitByEnemy(),S=!0;break}}}}catch(e){x.e(e)}finally{x.f()}if(!S){var E,j=o(w);try{for(j.s();!(E=j.n()).done;){var I=E.value,C=p.get(I);if(C&&C.isActive){var A=m.x-C.x,B=m.y-C.y,z=A*A+B*B,N=m.radius+C.radius;if(z<N*N){m.hitByEnemy(),C.isActive=!1;break}}}}catch(e){j.e(e)}finally{j.f()}}}}}catch(e){v.e(e)}finally{v.f()}var R,D=[],G=[],Y=o(u);try{for(Y.s();!(R=Y.n()).done;){var L=R.value;L.isDead?G.push(L):D.push(L)}}catch(e){Y.e(e)}finally{Y.f()}if(G.length>0&&D.length>0){var F,U=o(G);try{for(U.s();!(F=U.n()).done;){var X,W=F.value,V=(h.queryArea(W.x,W.y,2*W.radius),o(D));try{for(V.s();!(X=V.n()).done;){var q=X.value,J=W.x-q.x,H=W.y-q.y,K=J*J+H*H,Z=W.radius+q.radius;if(K<Z*Z){W.reviveByPlayer();break}}}catch(e){V.e(e)}finally{V.f()}}}catch(e){U.e(e)}finally{U.f()}}}}}catch(e){s.e(e)}finally{s.f()}}},{key:"handlePlayerTeleport",value:(n=u(l().mark((function e(t,r){var n,o,a,s,c,u,h,f,p,y,d,v,m,g,b,w,S,x,M,_,k,O,T,P,E,j,I,C,A,B,z,N,R,D;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.players.get(t)){e.next=3;break}return e.abrupt("return");case 3:if(o=n.currentMapId,a=this.mapManager.maps[o]){e.next=7;break}return e.abrupt("return");case 7:if(s=Math.floor(n.x/a.tileSize),c=Math.floor(n.y/a.tileSize),!r&&a.isTeleporter&&a.isTeleporter(s,c)&&(r=a.getTeleporter(s,c)),e.prev=10,u=parseInt(o.replace(/[^0-9]/g,""))-1,!(a.teleporterLinks&&a.teleporterLinks.length>0)){e.next=37;break}if(!(h=a.teleporterLinks.find((function(e){var t=i(e.fromKey.split(",").map(Number),3),r=t[0],n=t[1],o=t[2];return r===u&&n===s&&o===c})))){e.next=37;break}return console.log("[GAME] Using direct teleporter link for player ".concat(t.substring(0,8))),f=h.toKey.split(",").map(Number),p=i(f,3),y=p[0],d=p[1],v=p[2],m="map".concat(y+1),g={tileX:d,tileY:v,code:"link_".concat(h.fromKey,"_to_").concat(h.toKey)},e.next=21,this.loadMapIfNeeded(m);case 21:if(b=e.sent){e.next=25;break}return console.error("[GAME] Teleport failed: Destination map ".concat(m," could not be loaded.")),e.abrupt("return");case 25:return w=g.tileX*b.tileSize+b.tileSize/2,S=g.tileY*b.tileSize+b.tileSize/2,x=n.currentMapId,n.x=w,n.y=S,n.currentMapId=m,n.collider&&(n.collider.pos.x=w,n.collider.pos.y=S),n.needsToExitTeleporterArea={id:g.code,x:g.tileX*b.tileSize,y:g.tileY*b.tileSize,width:b.tileSize,height:b.tileSize,mapId:m},console.log("[GAME] Player ".concat(t.substring(0,8)," teleported from ").concat(x," to ").concat(m," at (").concat(w,", ").concat(S,") via direct link")),this.sendMapChangeToPlayer(n,t,b,m),this._idMapNeedsUpdate=!0,e.abrupt("return");case 37:e.next=42;break;case 39:e.prev=39,e.t0=e.catch(10),console.error("[GAME] Error processing teleporter link:",e.t0);case 42:if(r&&r.code){e.next=44;break}return e.abrupt("return");case 44:if(M=r.code,console.log("[GAME] Handling teleport for player ".concat(t.substring(0,8)," with code: ").concat(M)),M){e.next=49;break}return console.log("[GAME] Player ".concat(t.substring(0,8)," used a teleporter with no code. Ignoring.")),e.abrupt("return");case 49:_=null,k=0,O=Object.entries(this.mapManager.maps);case 51:if(!(k<O.length)){e.next=61;break}if(T=i(O[k],2),P=T[0],E=T[1],P===o||!E||"function"!=typeof E.getTeleporterByCode){e.next=58;break}if(!E.getTeleporterByCode(M)){e.next=58;break}return _=P,e.abrupt("break",61);case 58:k++,e.next=51;break;case 61:if(_){e.next=64;break}return console.log("[GAME] Player ".concat(t.substring(0,8)," used teleporter with code ").concat(M," on ").concat(o,", but no destination map found.")),e.abrupt("return");case 64:return e.next=66,this.loadMapIfNeeded(_);case 66:if(j=e.sent,console.log("[GAME] Destination map loaded:",{mapId:_,mapExists:!!j,hasTeleporterManager:!!j&&!!j.teleporterManager,hasTeleporterMethod:!!j&&"function"==typeof j.getTeleporterByCode}),j&&"function"==typeof j.getTeleporterByCode){e.next=71;break}return console.error("[GAME] Teleport failed for player ".concat(t.substring(0,8),": Destination map ").concat(_," could not be loaded or is invalid.")),e.abrupt("return");case 71:if(I=j.getTeleporterByCode(M)){e.next=75;break}return console.error("[GAME] Teleport failed for player ".concat(t.substring(0,8),": No teleporter with code ").concat(M," found on map ").concat(_,".")),e.abrupt("return");case 75:C=I.tileX*j.tileSize+j.tileSize/2,A=I.tileY*j.tileSize+j.tileSize/2,B=n.currentMapId,n.x=C,n.y=A,n.currentMapId=_,n.collider&&(n.collider.pos.x=C,n.collider.pos.y=A),I&&(z=I.tileX*j.tileSize,N=I.tileY*j.tileSize,R=I.width||j.tileSize,D=I.height||j.tileSize,n.needsToExitTeleporterArea={id:I.code,x:z,y:N,width:R,height:D,mapId:_}),console.log("[GAME] Player ".concat(t.substring(0,8)," teleported from ").concat(B," to ").concat(_," at (").concat(C,", ").concat(A,") via teleporter with code ").concat(M)),this.sendMapChangeToPlayer(n,t,j,_),this._idMapNeedsUpdate=!0;case 86:case"end":return e.stop()}}),e,this,[[10,39]])}))),function(e,t){return n.apply(this,arguments)})},{key:"sendMapChangeToPlayer",value:function(e,t,r,n){var i=this.connections.get(t);if(i&&1===i.readyState){var o=this.mapEnemies.get(n)||new Map,a=Array.from(o.values()).map((function(e){return e.serialize()})),s=this.mapBullets.get(n)||new Map,l=Array.from(s.values()).filter((function(e){return e.isActive})).map((function(e){return e.serialize()}));try{var c={width:r.width,height:r.height,tileSize:r.tileSize,map:r.tiles,teleporterCodes:r.teleporterCodes,teleporterLinks:r.teleporterLinks,enemyConfig:r.enemyConfig},u=_.encodeForNetwork(c);i.send(u);var h={type:"mapChange",newMapId:n,mapWidth:r.width,mapHeight:r.height,tileSize:r.tileSize,enemyTypes:w,enemies:a,bullets:l,playerData:e.serialize()},f=JSON.stringify(h),y=p.gzipSync(f);i.send(y),console.log("[GAME] Map change message sent to player ".concat(t.substring(0,8)))}catch(o){console.error("Failed to send optimized map data:",o);var d={type:"mapChange",newMapId:n,map:r.tiles,mapWidth:r.width,mapHeight:r.height,tileSize:r.tileSize,enemyTypes:w,enemies:a,bullets:l,playerData:e.serialize()},v=JSON.stringify(d);i.send(v),console.log("[GAME] Traditional map data sent to player ".concat(t.substring(0,8)," (fallback)"))}}}},{key:"forcePlayerToMapPosition",value:(r=u(l().mark((function e(t,r,n,i){var o,a,s,c,u,h,f,y,d,v;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.players.get(t)){e.next=4;break}return console.warn("forcePlayerToMapPosition: Player ".concat(t," not found.")),e.abrupt("return");case 4:if(a=this.connections.get(t),s=o.currentMapId,c=s!==r,o.x=n,o.y=i,o.vx=0,o.vy=0,o.collider&&(o.collider.pos.x=n,o.collider.pos.y=i),!c){e.next=35;break}return s&&this.broadcastPlayerLeave(t,s),o.currentMapId=r,e.prev=15,e.next=18,this.loadMapIfNeeded(r);case 18:e.next=25;break;case 20:return e.prev=20,e.t0=e.catch(15),console.error("forcePlayerToMapPosition: Failed to load target map ".concat(r," for player ").concat(t,":"),e.t0),a&&1===a.readyState&&a.close(1011,"Server error: Target map for reset could not be loaded."),e.abrupt("return");case 25:if(u=this.mapManager.getMapById(r)){e.next=30;break}return console.error("forcePlayerToMapPosition: Target map ".concat(r," data not found after attempting load for player ").concat(t,".")),a&&1===a.readyState&&a.close(1011,"Server error: Target map data unavailable after load."),e.abrupt("return");case 30:if(a&&1===a.readyState){h=this.mapEnemies.get(r)||new Map,f=Array.from(h.values()).map((function(e){return e.serialize()})),y={type:"mapChange",newMapId:r,map:u.tiles,mapWidth:u.width,mapHeight:u.height,tileSize:u.tileSize,enemyTypes:w,enemies:f,playerData:o.serialize()},d=JSON.stringify(y);try{v=p.gzipSync(d),a.send(v)}catch(e){console.error("forcePlayerToMapPosition: Failed to compress or send mapChange to ".concat(t,":"),e)}}this.broadcastNewPlayer(o),this._idMapNeedsUpdate=!0,e.next=35;break;case 35:case"end":return e.stop()}}),e,this,[[15,20]])}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"broadcastGameState",value:function(){var e=this;this._updateCounter++;var t=this._idMapNeedsUpdate||this._updateCounter<5;if(t){this._cachedPlayerIds.clear(),this._cachedEnemyIds.clear(),this._cachedBulletIds.clear(),this._playerIdCounter=1,this._enemyIdCounter=1,this._bulletIdCounter=1;var r,n=o(this.players.values());try{for(n.s();!(r=n.n()).done;){var a=r.value;this._cachedPlayerIds.has(a.id)||this._cachedPlayerIds.set(a.id,this._playerIdCounter++)}}catch(e){n.e(e)}finally{n.f()}var s,l=o(this.mapEnemies.values());try{for(l.s();!(s=l.n()).done;){var c,u=o(s.value.values());try{for(u.s();!(c=u.n()).done;){var h=c.value;this._cachedEnemyIds.has(h.id)||this._cachedEnemyIds.set(h.id,this._enemyIdCounter++)}}catch(e){u.e(e)}finally{u.f()}}}catch(e){l.e(e)}finally{l.f()}var f,y=o(this.mapBullets.values());try{for(y.s();!(f=y.n()).done;){var d,v=o(f.value.values());try{for(v.s();!(d=v.n()).done;){var m=d.value;this._cachedBulletIds.has(m.id)||this._cachedBulletIds.set(m.id,this._bulletIdCounter++)}}catch(e){v.e(e)}finally{v.f()}}}catch(e){y.e(e)}finally{y.f()}}var g,b=o(this.connections);try{for(b.s();!(g=b.n()).done;){var w=i(g.value,2),S=w[0],x=w[1];if(1===x.readyState){var M,_=this.players.get(S);if(M=_?_.currentMapId:k.DEFAULT_MAP_ID){var O,T=[],P=o(this.players.values());try{for(P.s();!(O=P.n()).done;){var E=O.value;E.currentMapId===M&&T.push(E)}}catch(e){P.e(e)}finally{P.f()}var j=this.mapEnemies.get(M)||new Map,I=this.mapBullets.get(M)||new Map,C={t:"u",p:T.map((function(t){return[e._cachedPlayerIds.get(t.id)||t.id,Math.round(t.x),Math.round(t.y),t.isDead?1:0,t.name]})),e:Array.from(j.values()).map((function(t){return[e._cachedEnemyIds.get(t.id)||t.id,t.type,Math.round(t.x),Math.round(t.y),t.radius]})),b:Array.from(I.values()).filter((function(e){return e.isActive})).map((function(t){return[e._cachedBulletIds.get(t.id)||t.id,Math.round(t.x),Math.round(t.y),t.radius]}))};if(t){C.idMap={p:{},e:{},b:{}};var A,B=o(T);try{for(B.s();!(A=B.n()).done;){var z=A.value,N=this._cachedPlayerIds.get(z.id);N&&(C.idMap.p[N]=z.id)}}catch(e){B.e(e)}finally{B.f()}var R,D=o(j.values());try{for(D.s();!(R=D.n()).done;){var G=R.value,Y=this._cachedEnemyIds.get(G.id);Y&&(C.idMap.e[Y]=G.id)}}catch(e){D.e(e)}finally{D.f()}var L,F=o(I.values());try{for(F.s();!(L=F.n()).done;){var U=L.value;if(U.isActive){var X=this._cachedBulletIds.get(U.id);X&&(C.idMap.b[X]=U.id)}}}catch(e){F.e(e)}finally{F.f()}}var W=JSON.stringify(C);try{var V=p.gzipSync(W);x.send(V)}catch(e){console.error("Failed to compress and send game state to "+S+":",e)}}else console.warn("No mapIdToBroadcast determined for connection ".concat(S,". Active player: ").concat(!!_))}}}catch(e){b.e(e)}finally{b.f()}t&&(this._idMapNeedsUpdate=!1)}},{key:"broadcastNewPlayer",value:function(e){var t,r={type:"newPlayer",player:e.serialize()},n=JSON.stringify(r),a=p.gzipSync(n),s=o(this.connections);try{for(s.s();!(t=s.n()).done;){var l=i(t.value,2),c=l[0],u=l[1],h=this.players.get(c);h&&h.id!==e.id&&h.currentMapId===e.currentMapId&&1===u.readyState&&u.send(a)}}catch(e){s.e(e)}finally{s.f()}}},{key:"broadcastPlayerLeave",value:function(e,t){var r,n={type:"playerLeave",playerId:e},a=JSON.stringify(n),s=p.gzipSync(a),l=o(this.connections);try{for(l.s();!(r=l.n()).done;){var c=i(r.value,2),u=c[0],h=c[1],f=this.players.get(u);f&&f.currentMapId===t&&1===h.readyState&&h.send(s)}}catch(e){l.e(e)}finally{l.f()}}},{key:"cleanupUnusedMaps",value:function(){var e,t=Date.now(),r=new Set,n=o(this.players.values());try{for(n.s();!(e=n.n()).done;){var a=e.value;a.currentMapId&&r.add(a.currentMapId)}}catch(e){n.e(e)}finally{n.f()}var s,l=o(this._mapLastAccessed.entries());try{for(l.s();!(s=l.n()).done;){var c=i(s.value,2),u=c[0],h=c[1];if(!r.has(u)){var f=(t-h)/1e3;f>this._unusedMapTimeout&&(console.log("Cleaning up unused map: ".concat(u," (unused for ").concat(Math.floor(f)," seconds)")),this.mapGrids.has(u)&&(this.mapGrids.get(u).clear(),this.mapGrids.delete(u)),this.mapEnemies.has(u)&&this.mapEnemies.delete(u),this.mapBullets.has(u)&&this.mapBullets.delete(u),this._mapLastAccessed.delete(u))}}}catch(e){l.e(e)}finally{l.f()}}},{key:"cleanupCachedIds",value:function(){var e,t=o(this._cachedPlayerIds.entries());try{for(t.s();!(e=t.n()).done;){var r=i(e.value,2),n=r[0];r[1],this.players.has(n)||this._cachedPlayerIds.delete(n)}}catch(e){t.e(e)}finally{t.f()}var a,s=new Set,l=o(this.mapEnemies.values());try{for(l.s();!(a=l.n()).done;){var c,u=o(a.value.keys());try{for(u.s();!(c=u.n()).done;){var h=c.value;s.add(h)}}catch(e){u.e(e)}finally{u.f()}}}catch(e){l.e(e)}finally{l.f()}var f,p=o(this._cachedEnemyIds.entries());try{for(p.s();!(f=p.n()).done;){var y=i(f.value,1)[0];s.has(y)||this._cachedEnemyIds.delete(y)}}catch(e){p.e(e)}finally{p.f()}var d,v=new Set,m=o(this.mapBullets.values());try{for(m.s();!(d=m.n()).done;){var g,b=o(d.value.keys());try{for(b.s();!(g=b.n()).done;){var w=g.value;v.add(w)}}catch(e){b.e(e)}finally{b.f()}}}catch(e){m.e(e)}finally{m.f()}var S,x=o(this._cachedBulletIds.entries());try{for(x.s();!(S=x.n()).done;){var M=i(S.value,1)[0];v.has(M)||this._cachedBulletIds.delete(M)}}catch(e){x.e(e)}finally{x.f()}}}],t&&h(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r,n,a,s}();e.exports={Game:O}},748:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=a(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function a(e,t){if(e){if("string"==typeof e)return s(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function c(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var u=r(422),h=u.Enemy,f=u.Sniper,p=u.Dasher,y=u.Homing,d=u.VoidCrawler,v=u.Wall,m=u.RecursiveBulletBoss,g=function(){return e=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mapManager=t,this.mapGrids=r,this.mapEnemies=n,m?console.log("RecursiveBulletBoss class loaded successfully in EnemySpawner"):console.error("ERROR: RecursiveBulletBoss class not loaded properly!")},t=[{key:"spawnEnemiesForMap",value:function(e,t,r){if(t&&r){var n=this.mapEnemies.get(e);if(n){for(var s=t.enemyConfig,l=s.spawnTileType,c=s.types,u=0,g=function(){var e=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],l=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(w[b],2),s=e[0],c=e[1],g=c.count,S=c.radius,x=c.minSpeed,M=c.maxSpeed;if(console.log("Spawning enemy type: ".concat(s,", count: ").concat(g,", radius: ").concat(S)),"basic"===s)for(var _=0;_<g;_++){var k=t.getValidSpawnPosition(l,S,r);if(k){var O=x+Math.random()*(M-x),T=new h(k.x,k.y,S,O,1);T.addToGrid(r),n.set(T.id,T),u++}}else if("sniper"===s)for(var P=0;P<g;P++){var E=t.getValidSpawnPosition(l,S,r);if(E){var j=x+Math.random()*(M-x),I=new f(E.x,E.y,S,j,c.detectionRange,c.shootingRange,c.maxShootCooldown,c.bulletRadius,c.bulletSpeed);I.addToGrid(r),n.set(I.id,I),u++}}else if("dasher"===s)for(var C=0;C<g;C++){var A=t.getValidSpawnPosition(l,S,r);if(A){var B=x+Math.random()*(M-x),z=new p(A.x,A.y,S,B,c.timeToPrepare,c.timeToDash,c.timeBetweenDashes);z.addToGrid(r),n.set(z.id,z),u++}}else if("homing"===s)for(var N=0;N<g;N++){var R=t.getValidSpawnPosition(l,S,r);if(R){var D=x+Math.random()*(M-x),G=new y(R.x,R.y,S,D,c.turnIncrement,c.homeRange);G.addToGrid(r),n.set(G.id,G),u++}}else if("void_crawler"===s)for(var Y=0;Y<g;Y++){var L=t.getValidSpawnPosition(l,S,r);if(L){var F=x+Math.random()*(M-x),U=new d(L.x,L.y,S,F,c.turnIncrement,c.homeRange);U.addToGrid(r),n.set(U.id,U),u++}}else if("recursive_bullet_boss"===s)try{if(!m)throw new Error("RecursiveBulletBoss class not available");console.log("Spawning ".concat(g," RecursiveBulletBoss enemies with config:"),c);for(var X=0;X<g;X++){var W=t.getValidSpawnPosition(l,S,r);if(W){var V=x+Math.random()*(M-x);console.log("Creating RecursiveBulletBoss at (".concat(W.x,", ").concat(W.y,") with speed ").concat(V));var q=new m(W.x,W.y,S,V,c.shootCooldown||120,c.bulletRadius||8,c.bulletSpeed||4,c.recursionLevels||2);q.addToGrid(r),n.set(q.id,q),console.log("RecursiveBulletBoss added to grid with ID: ".concat(q.id)),u++}else console.warn("Could not find valid spawn position for RecursiveBulletBoss #".concat(X+1))}}catch(e){console.error("Error spawning RecursiveBulletBoss: ".concat(e.message)),console.error(e.stack)}else if("wall"===s){var J=t.findConnectedRegions(1),H=0,K=void 0===c.moveClockwise||c.moveClockwise,Z=void 0!==c.patternAlternate&&c.patternAlternate,$=void 0!==c.initialSide?c.initialSide:0;J.sort((function(e,t){var r=2*(e.maxX-e.minX+1+(e.maxY-e.minY+1));return 2*(t.maxX-t.minX+1+(t.maxY-t.minY+1))-r}));var Q,ee=0,te=J.map((function(e){var r=2*((e.maxX-e.minX+1)*t.tileSize+(e.maxY-e.minY+1)*t.tileSize);return ee+=r,{region:e,perimeter:r}})),re=10*S,ne=o(te);try{for(ne.s();!(Q=ne.n()).done;){var ie=Q.value,oe=ie.region,ae=ie.perimeter;if(ae<re)console.log("Region too small (perimeter: ".concat(ae,") for wall placement, skipping"));else{var se=Math.max(1,Math.floor(ae/ee*g));if(!(oe.tiles.length<4)){var le=Math.min.apply(Math,i(oe.tiles.map((function(e){return e.x})))),ce=Math.max.apply(Math,i(oe.tiles.map((function(e){return e.x})))),ue=Math.min.apply(Math,i(oe.tiles.map((function(e){return e.y})))),he=Math.max.apply(Math,i(oe.tiles.map((function(e){return e.y})))),fe=le*t.tileSize,pe=ue*t.tileSize,ye=(ce-le+1)*t.tileSize,de=(he-ue+1)*t.tileSize,ve=3*S,me=2*(ye+de),ge=Math.floor(me/ve);if(ge<2)console.log("Region can only fit ".concat(ge," walls with proper spacing, skipping"));else{for(var be=Math.min(se,ge,g-H),we=me/be,Se=[],xe=0;xe<be;xe++){var Me=x+Math.random()*(M-x),_e=new v(0,0,S,Me,fe,pe,ye,de,xe,be,Z?xe%2==0?K:!K:K,$,we);Se.push(_e)}for(var ke=[],Oe=0,Te=Se;Oe<Te.length;Oe++){var Pe,Ee=Te[Oe],je=!1,Ie=o(ke);try{for(Ie.s();!(Pe=Ie.n()).done;){var Ce=Pe.value,Ae=Ee.x-Ce.x,Be=Ee.y-Ce.y;if(Math.sqrt(Ae*Ae+Be*Be)<Ee.radius+Ce.radius){je=!0;break}}}catch(e){Ie.e(e)}finally{Ie.f()}je||ke.push(Ee)}for(var ze=0,Ne=ke;ze<Ne.length;ze++){var Re=Ne[ze];Re.addToGrid(r),n.set(Re.id,Re),H++}if(console.log("Added ".concat(ke.length," wall enemies to region (requested: ").concat(be,")")),H>=g)break}}}}}catch(e){ne.e(e)}finally{ne.f()}u+=H}},b=0,w=Object.entries(c);b<w.length;b++)g();console.log("Spawned ".concat(u," enemies for map ").concat(e," (Types: ").concat(Object.keys(c).join(", "),")"))}else console.error("enemy map not initialized for ".concat(e))}else console.error("cannot spawn enemies for ".concat(e," map or grid missing."))}}],t&&l(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();e.exports={EnemySpawner:g}},789:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function s(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var l=r(896),c=r(928),u=r(106),h=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"encodeToBinary",value:function(e){var t=Buffer.alloc(16);t.writeUInt32LE(e.width,0),t.writeUInt32LE(e.height,4),t.writeUInt32LE(e.tileSize,8),t.writeUInt32LE(0,12);var r=Buffer.alloc(e.width*e.height);if(Array.isArray(e.map))for(var n=0,o=0;o<e.height;o++)for(var a=0;a<e.width;a++)r[n++]=e.map[o][a];else if(Array.isArray(e.encodedMap))for(var s=0,l=0;l<e.encodedMap.length;l+=2)for(var c=e.encodedMap[l],h=e.encodedMap[l+1],f=0;f<h;f++)r[s++]=c;var p=Buffer.alloc(0);if(e.teleporterCodes&&e.teleporterCodes.length>0){var y=Buffer.alloc(4);y.writeUInt32LE(e.teleporterCodes.length,0);var d,v=[],m=4,g=i(e.teleporterCodes);try{for(g.s();!(d=g.n()).done;){var b=d.value,w=Buffer.from(b.code,"utf8"),S=Buffer.alloc(4);S.writeUInt32LE(w.length,0);var x=Buffer.from(b.mapId||"","utf8"),M=Buffer.alloc(4);M.writeUInt32LE(x.length,0),v.push(S,w,M,x),m+=8+w.length+x.length}}catch(e){g.e(e)}finally{g.f()}p=Buffer.concat([y].concat(v),m)}var _=Buffer.from(JSON.stringify(e.enemyConfig),"utf8"),k=Buffer.alloc(4);k.writeUInt32LE(_.length,0);var O=Buffer.concat([t,r,p,k,_]);return u.deflateSync(O)}},{key:"decodeFromBinary",value:function(e){for(var t=u.inflateSync(e),r=t.readUInt32LE(0),n=t.readUInt32LE(4),i=t.readUInt32LE(8),o=(t.readUInt32LE(12),r*n),a=t.slice(16,16+o),s=[],l=0;l<n;l++){s[l]=[];for(var c=0;c<r;c++)s[l][c]=a[l*r+c]}var h=16+o,f=[];if(h<t.length){var p=t.readUInt32LE(h);h+=4;for(var y=0;y<p;y++){var d=t.readUInt32LE(h);h+=4;var v=t.slice(h,h+d).toString("utf8");h+=d;var m=t.readUInt32LE(h);h+=4;var g=t.slice(h,h+m).toString("utf8");h+=m,f.push({code:v,mapId:g})}}var b={};if(h<t.length){var w=t.readUInt32LE(h);if(h+=4,w>0){var S=t.slice(h,h+w).toString("utf8");try{b=JSON.parse(S)}catch(e){console.error("Failed to parse enemy config:",e)}}}return{width:r,height:n,tileSize:i,map:s,teleporterCodes:f,enemyConfig:b}}},{key:"saveBinaryMap",value:function(e,t){var r=this.encodeToBinary(e);return l.writeFileSync(t,r),r.length}},{key:"loadBinaryMap",value:function(e){var t=l.readFileSync(e);return this.decodeFromBinary(t)}},{key:"convertJsonMapsToBinary",value:function(e,t){l.existsSync(t)||l.mkdirSync(t,{recursive:!0});var r,n=[],o=i(l.readdirSync(e).filter((function(e){return e.endsWith(".json")})));try{for(o.s();!(r=o.n()).done;){var a=r.value,s=c.join(e,a),u=c.join(t,a.replace(".json",".bmap"));try{var h=JSON.parse(l.readFileSync(s,"utf8")),f=this.saveBinaryMap(h,u),p=l.statSync(s).size;n.push({file:a,jsonSize:p,binarySize:f,compressionRatio:(p/f).toFixed(2)})}catch(e){console.error("Failed to convert ".concat(a,":"),e)}}}catch(e){o.e(e)}finally{o.f()}return n}},{key:"encodeForNetwork",value:function(e){var t={width:e.width,height:e.height,tileSize:e.tileSize,tiles:this._flattenTileArray(e.map||(e.encodedMap?r(476).decodeMap(e.encodedMap,e.width,e.height):[])),teleporterCodes:e.teleporterCodes||[],enemyConfig:e.enemyConfig};return console.log("Encoding network map with teleporters:",{hasTeleporterCodes:t.teleporterCodes&&t.teleporterCodes.length>0,teleporterCount:t.teleporterCodes?t.teleporterCodes.length:0}),u.deflateSync(JSON.stringify(t))}},{key:"decodeFromNetwork",value:function(e){var t=JSON.parse(u.inflateSync(e).toString("utf8"));return t.map=this._expandTileArray(t.tiles,t.width,t.height),delete t.tiles,t.teleporterCodes||(console.warn("Missing teleporter codes in network map data"),t.teleporterCodes=[]),console.log("Decoded network map:",{width:t.width,height:t.height,hasTeleporterCodes:t.teleporterCodes&&t.teleporterCodes.length>0,teleporterCount:t.teleporterCodes?t.teleporterCodes.length:0}),t}},{key:"_flattenTileArray",value:function(e){if(!e||!e.length)return[];for(var t=[],r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++)t.push(e[r][n]);return t}},{key:"_expandTileArray",value:function(e,t,r){for(var n=[],i=0;i<r;i++){n[i]=[];for(var o=0;o<t;o++)n[i][o]=e[i*t+o]}return n}}],null&&a(e.prototype,null),t&&a(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();e.exports=h},833:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function o(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var a=r(903).v4,s=r(110).MS_PER_GAME_TICK,l=function(){return e=function e(t,r,n,i,o,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="bullet_".concat(a()),this.x=t,this.y=r,this.prevX=t,this.prevY=r,this.radius=o,this.speed=s,this.color="#FFFF00",this.outlineColor="#FF8C00";var l=n-t,c=i-r,u=l*l+c*c;if(u>0){var h=Math.sqrt(u);this.vx=l/h*s,this.vy=c/h*s}else this.vx=0,this.vy=-s;this.lastUpdateTime=Date.now(),this.isActive=!0,this._collisionShape={id:this.id,x:0,y:0,radius:this.radius}},(t=[{key:"update",value:function(e,t){if(this.isActive){var r=Date.now(),n=(r-this.lastUpdateTime)/s;this.lastUpdateTime=r,this.prevX=this.x,this.prevY=this.y;var i=this.x+this.vx*n,o=this.y+this.vy*n;this._collisionShape.x=i,this._collisionShape.y=o,t.checkWallCollision(this._collisionShape)||t.checkSafeZoneCollision(this._collisionShape)||t.checkTeleporterCollision(this._collisionShape)||i-this.radius<0||i+this.radius>e.width*e.tileSize||o-this.radius<0||o+this.radius>e.height*e.tileSize?this.isActive=!1:(this.x=i,this.y=o,t.update(this))}}},{key:"serialize",value:function(){return{id:this.id,x:this.x,y:this.y,prevX:this.prevX,prevY:this.prevY,radius:this.radius,isActive:this.isActive}}},{key:"addToGrid",value:function(e){e.insert(this)}},{key:"removeFromGrid",value:function(e){e.remove(this.id)}}])&&i(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();e.exports={Bullet:l}},854:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return(t=l(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,l(n.key),n)}}function l(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}function c(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(c=function(){return!!e})()}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},u.apply(null,arguments)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}var p=r(110),y=p.Enemy,d=p.MS_PER_GAME_TICK,v=function(e){function t(e,r,i,o){var a,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:750,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3e3,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:750;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=function(e,t,r){return t=h(t),function(e,t){if(t&&("object"==n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,c()?Reflect.construct(t,r||[],h(e).constructor):t.apply(e,r))}(this,t,[e,r,i,o,3])).speed=o,a.time_to_prepare=s,a.time_to_dash=l,a.time_between_dashes=u,a.normal_speed=o,a.base_speed=a.normal_speed/5,a.prepare_speed=a.normal_speed/5,a.dash_speed=a.normal_speed,a.time_dashing=0,a.time_preparing=0,a.time_since_last_dash=0,a.lastUpdateTimeMs=Date.now(),a.originalVx=a.vx,a.originalVy=a.vy,a.originalSpeed=Math.sqrt(a.vx*a.vx+a.vy*a.vy),0===a.originalSpeed&&a.speed>0){var f=Math.random()*Math.PI*2;a.originalVx=Math.cos(f)*a.speed,a.originalVy=Math.sin(f)*a.speed,a.originalSpeed=a.speed}return a.hitWall=!1,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(t,e),r=t,i=[{key:"compute_speed",value:function(){var e;(e=this.time_since_last_dash<this.time_between_dashes&&0===this.time_dashing&&0===this.time_preparing?0:0===this.time_dashing?this.prepare_speed:this.base_speed)!==this.speed&&(this.speed=e,this.updateVelocity())}},{key:"updateVelocity",value:function(){if(0===this.speed)return this.vx=0,void(this.vy=0);if(this.originalSpeed>0){var e=this.originalVx/this.originalSpeed,t=this.originalVy/this.originalSpeed;this.vx=e*this.speed,this.vy=t*this.speed}else{var r=Math.random()*Math.PI*2;this.vx=Math.cos(r)*this.speed,this.vy=Math.sin(r)*this.speed,this.originalVx=this.vx,this.originalVy=this.vy,this.originalSpeed=this.speed}}},{key:"update",value:function(e,t,r){var n=Date.now(),i=n-this.lastUpdateTimeMs;this.lastUpdateTimeMs=n,this.behavior(i);var o=Date.now(),a=(o-this.lastUpdateTime)/d;this.lastUpdateTime=o,this.prevX=this.x,this.prevY=this.y;var s=!1,l=this.x+this.vx*a,c=this.y+this.vy*a;if(this._collisionShape.x=l,this._collisionShape.y=this.y,this._collisionShape.radius=this.radius,t.checkWallCollision(this._collisionShape)||t.checkSafeZoneCollision(this._collisionShape)||t.checkTeleporterCollision(this._collisionShape)?(this.vx=-this.vx,this.hitWall=!0,s=!1):(this.x=l,s=!0),this._collisionShape.x=this.x,this._collisionShape.y=c,t.checkWallCollision(this._collisionShape)||t.checkSafeZoneCollision(this._collisionShape)||t.checkTeleporterCollision(this._collisionShape)?(this.vy=-this.vy,this.hitWall=!0,s=!1):(this.y=c,s=!0),this._collisionShape.x=this.x,this._collisionShape.y=this.y,(t.checkWallCollision(this._collisionShape)||t.checkSafeZoneCollision(this._collisionShape)||t.checkTeleporterCollision(this._collisionShape)||this.x-this.radius<0||this.x+this.radius>e.width*e.tileSize||this.y-this.radius<0||this.y+this.radius>e.height*e.tileSize)&&(this.x=this.prevX,this.y=this.prevY,s=!1,this.vx=-this.vx,this.vy=-this.vy,this.hitWall=!0),s&&t.update(this),this.hitWall){if(this.originalVx=this.vx,this.originalVy=this.vy,this.originalSpeed=Math.sqrt(this.vx*this.vx+this.vy*this.vy),0===this.originalSpeed&&this.speed>0){var u=Math.random()*Math.PI*2;this.originalVx=Math.cos(u),this.originalVy=Math.sin(u),this.originalSpeed=1}this.hitWall=!1,this.updateVelocity()}}},{key:"behavior",value:function(e){0===this.time_preparing?0===this.time_dashing?this.time_since_last_dash<this.time_between_dashes?this.time_since_last_dash+=e:(this.time_since_last_dash=0,this.time_preparing+=e,this.base_speed=this.prepare_speed):(this.time_dashing+=e,this.time_dashing>this.time_to_dash?(this.time_dashing=0,this.base_speed=this.normal_speed):this.base_speed=this.dash_speed*(1-this.time_dashing/this.time_to_dash)):(this.time_preparing+=e,this.time_preparing>this.time_to_prepare?(this.time_preparing=0,this.time_dashing+=e,this.base_speed=this.dash_speed):this.base_speed=this.prepare_speed*(1-this.time_preparing/this.time_to_prepare)),this.compute_speed()}},{key:"serialize",value:function(){var e,r,n;return o(o({},(e=t,r=this,"function"==typeof(n=u(h(1&3?e.prototype:e),"serialize",r))?function(e){return n.apply(r,e)}:n)([])),{},{time_dashing:this.time_dashing,time_preparing:this.time_preparing,time_since_last_dash:this.time_since_last_dash})}}],i&&s(r.prototype,i),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i}(y);e.exports={Dasher:v}},876:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function a(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var l=r(896),c=r(928),u=r(912).Map,h=r(789),f=function(){return a((function e(){i(this,e),this.maps={},this.currentMapId="map1",this.useBinaryMaps=!0,this.loadMaps()}),[{key:"loadMaps",value:function(){var e=this;["map1"].forEach((function(t){var r=c.join(__dirname,"maps","".concat(t,".bmap")),n=c.join(__dirname,"maps","".concat(t,".json"));try{if(e.useBinaryMaps&&l.existsSync(r)){console.log("Loading binary map from: ".concat(r));var i=Date.now(),o=h.loadBinaryMap(r);o.mapId=t,e.maps[t]=new u(o);var a=Date.now()-i;console.log("Binary map ".concat(t," loaded successfully in ").concat(a,"ms")),o.teleporterLinks&&o.teleporterLinks.length>0&&(console.log("Map ".concat(t," has ").concat(o.teleporterLinks.length," teleporter links")),e.maps[t].teleporterManager&&"function"==typeof e.maps[t].teleporterManager.setTeleporterLinks&&e.maps[t].teleporterManager.setTeleporterLinks(o.teleporterLinks))}else{console.log("Loading JSON map from: ".concat(n));var s=Date.now(),f=l.readFileSync(n,"utf8"),p=JSON.parse(f);p.mapId=t,e.maps[t]=new u(p);var y=Date.now()-s;if(console.log("JSON map ".concat(t," loaded successfully in ").concat(y,"ms")),p.teleporterLinks&&p.teleporterLinks.length>0&&(console.log("Map ".concat(t," has ").concat(p.teleporterLinks.length," teleporter links")),e.maps[t].teleporterManager&&"function"==typeof e.maps[t].teleporterManager.setTeleporterLinks&&e.maps[t].teleporterManager.setTeleporterLinks(p.teleporterLinks)),e.useBinaryMaps)try{var d=h.saveBinaryMap(p,r);console.log("Converted ".concat(t," to binary format (").concat(d," bytes)"))}catch(e){console.error("Error converting map ".concat(t," to binary:"),e)}}}catch(e){console.error("Error loading map ".concat(t,":"),e)}}))}},{key:"getCurrentMap",value:function(){return this.maps[this.currentMapId]}},{key:"getMapById",value:function(e){return this.maps[e]||null}},{key:"changeMap",value:function(e){return!!this.maps[e]&&(this.currentMapId=e,!0)}},{key:"convertAllMapsToBinary",value:function(){var e=c.join(__dirname,"maps"),t=h.convertJsonMapsToBinary(e,e);return console.log("Map conversion results:",t),t}}])}(),p=a((function e(){i(this,e);var t=c.join(__dirname,"maps","map1.json");console.log("Loading backward compatibility map from: ".concat(t));try{var r=l.readFileSync(t,"utf8"),n=JSON.parse(r);return n.mapId="map1",new u(n)}catch(e){return console.error("Error in MapBackwardCompatibility:",e),null}}));e.exports={MapManager:f,Map:p}},896:e=>{"use strict";e.exports=require("fs")},903:e=>{"use strict";e.exports=require("uuid")},912:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function s(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var l=r(476),c=r(62),u=c.Teleporter,h=c.TeleporterManager,f=function(){return e=function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=t.width,this.height=t.height,this.tileSize=t.tileSize,this.enemyConfig=t.enemyConfig,this.mapId=t.mapId||null,t.map?this.tiles=t.map:t.encodedMap?(this.encodedMap=t.encodedMap,this.tiles=l.decodeMap(this.encodedMap,this.width,this.height)):(console.error("No valid map data provided in map configuration"),this.tiles=new Array(this.height).fill(0).map((function(){return new Array(r.width).fill(0)}))),this.teleporterManager=new h,this.findTeleporterTiles(),t.teleporterLinks&&t.teleporterLinks.length>0?(this.teleporterLinks=t.teleporterLinks,this.teleporterManager.setTeleporterLinks(this.teleporterLinks),console.log("Initialized ".concat(this.teleporterLinks.length," teleporter links for map ").concat(this.mapId||"unknown"))):this.teleporterLinks=[],t.teleporterCodes&&t.teleporterCodes.length>0?(this.teleporterCodes=t.teleporterCodes,this.teleporterManager.associateTeleporterCodes(this.teleporterCodes),console.log("Initialized ".concat(this.teleporterCodes.length," teleporters for map ").concat(this.mapId||"unknown"))):(console.warn("No teleporter codes provided for map ".concat(this.mapId||"unknown")),this.teleporterCodes=[])},t=[{key:"findTeleporterTiles",value:function(){for(var e=0;e<this.height;e++)for(var t=0;t<this.width;t++)if(3===this.tiles[e][t]){var r=new u(t,e);this.teleporterManager.addTeleporter(r)}}},{key:"isWall",value:function(e,t){return e<0||t<0||e>=this.width||t>=this.height||0===this.tiles[t][e]}},{key:"getTileType",value:function(e,t){return e<0||t<0||e>=this.width||t>=this.height?0:this.tiles[t][e]}},{key:"isSafeZone",value:function(e,t){if(e<0||t<0||e>=this.width||t>=this.height)return!1;var r=this.tiles[t][e];return 2===r||4===r}},{key:"getRandomTypePosition",value:function(e){for(var t=[],r=0;r<this.height;r++)for(var n=0;n<this.width;n++)this.tiles[r][n]===e&&t.push({x:n,y:r});if(0===t.length)return null;var i=t[Math.floor(Math.random()*t.length)];return{x:i.x*this.tileSize+this.tileSize/2,y:i.y*this.tileSize+this.tileSize/2}}},{key:"getValidSpawnPosition",value:function(e,t,r){for(var n=[],i=0;i<this.height;i++)for(var o=0;o<this.width;o++)if(this.getTileType(o,i)===e){var a=o*this.tileSize+this.tileSize/2,s=i*this.tileSize+this.tileSize/2;r.isValidSpawnPosition(a,s,t)&&n.push({x:a,y:s})}return 0===n.length?null:n[Math.floor(Math.random()*n.length)]}},{key:"isTeleporter",value:function(e,t){return 3===this.tiles[t][e]}},{key:"getTeleporter",value:function(e,t){return this.teleporterManager.getTeleporterByPosition(e,t)}},{key:"getTeleporterByCode",value:function(e){return this.teleporterManager.getTeleporterByCode(e)}},{key:"getTeleporterByLink",value:function(e,t,r){return this.teleporterManager.getTeleporterByLink(e,t,r)}},{key:"findConnectedRegions",value:function(e){for(var t=this,r=new Array(this.height).fill(0).map((function(){return new Array(t.width).fill(!1)})),n=[],o=function(n,o){var a=[{x:n,y:o}],s=[];for(r[o][n]=!0;a.length>0;){var l=a.shift(),c=l.x,u=l.y;s.push({x:c,y:u});for(var h=0,f=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}];h<f.length;h++){var p=f[h],y=c+p.dx,d=u+p.dy;y<0||y>=t.width||d<0||d>=t.height||t.tiles[d][y]!==e||r[d][y]||(r[d][y]=!0,a.push({x:y,y:d}))}}var v=Math.min.apply(Math,i(s.map((function(e){return e.x})))),m=Math.max.apply(Math,i(s.map((function(e){return e.x})))),g=Math.min.apply(Math,i(s.map((function(e){return e.y})))),b=Math.max.apply(Math,i(s.map((function(e){return e.y}))));return{tiles:s,centerX:Math.floor(s.reduce((function(e,t){return e+t.x}),0)/s.length),centerY:Math.floor(s.reduce((function(e,t){return e+t.y}),0)/s.length),minX:v,maxX:m,minY:g,maxY:b,width:m-v+1,height:b-g+1}},a=0;a<this.height;a++)for(var s=0;s<this.width;s++)if(this.tiles[a][s]===e&&!r[a][s]){var l=o(s,a);n.push(l)}return n}}],t&&a(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();e.exports={Map:f}},928:e=>{"use strict";e.exports=require("path")}},t={};!function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}(127)})();